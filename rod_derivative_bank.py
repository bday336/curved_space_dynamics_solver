# Manually writing the derivative functions for the rigid rod systems.

from numpy import *

###############
##### H3 ######
###############

## Rigid Rod ##

## RadauIIA s2 ##

def h3rads2rodex1(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2)

    da1c1term = 1.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = -a11*dt
    dad1c2term = -a12*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex2(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a1c2 - a1n - dt*(a21*ad1c1 + a22*ad1c2)

    da1c1term = 0.
    da1c2term = 1.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = -a21*dt
    dad1c2term = -a22*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex3(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b1c1 - b1n - dt*(a11*bd1c1 + a12*bd1c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 1.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = -a11*dt
    dbd1c2term = -a12*dt
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex4(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b1c2 - b1n - dt*(a21*bd1c1 + a22*bd1c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 1.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = -a21*dt
    dbd1c2term = -a22*dt
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex5(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*gd1c1 + a12*gd1c2) + g1c1 - g1n

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 1.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = -a11*dt
    dgd1c2term = -a12*dt

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex6(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*gd1c1 + a22*gd1c2) + g1c2 - g1n

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 1.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = -a21*dt
    dgd1c2term = -a22*dt

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex7(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a2c1 - a2n - dt*(a11*ad2c1 + a12*ad2c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 1.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = -a11*dt
    dad2c2term = -a12*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex8(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a2c2 - a2n - dt*(a21*ad2c1 + a22*ad2c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 1.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = -a21*dt
    dad2c2term = -a22*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex9(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b2c1 - b2n - dt*(a11*bd2c1 + a12*bd2c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 1.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = -a11*dt
    dbd2c2term = -a12*dt
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex10(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b2c2 - b2n - dt*(a21*bd2c1 + a22*bd2c2)

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 1.
    dg2c1term = 0.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = -a21*dt
    dbd2c2term = -a22*dt
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex11(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*gd2c1 + a12*gd2c2) + g2c1 - g2n

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 1.
    dg2c2term = 0.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = -a11*dt
    dgd2c2term = -a12*dt

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex12(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*gd2c1 + a22*gd2c2) + g2c2 - g2n

    da1c1term = 0.
    da1c2term = 0.
    db1c1term = 0.
    db1c2term = 0.
    dg1c1term = 0.
    dg1c2term = 0.

    da2c1term = 0.
    da2c2term = 0.
    db2c1term = 0.
    db2c2term = 0.
    dg2c1term = 0.
    dg2c2term = 1.

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = -a21*dt
    dgd2c2term = -a22*dt

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex13(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad1c1 - ad1n - dt*(a11*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sinh(2.0*a1c1)) + a12*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sinh(2.0*a1c2)))

    da1c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cosh(2.0*a1c1))
    da1c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cosh(2.0*a1c2))
    db1c1term = -a11*dt*(1.0*gd1c1**2.0*sin(b1c1)**1.0*cos(b1c1)*sinh(2.0*a1c1) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a12*dt*(1.0*gd1c2**2.0*sin(b1c2)**1.0*cos(b1c2)*sinh(2.0*a1c2) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a11*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a12*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 1.
    dad1c2term = 0.
    dbd1c1term = -1.0*a11*bd1c1**1.0*dt*sinh(2.0*a1c1)
    dbd1c2term = -1.0*a12*bd1c2**1.0*dt*sinh(2.0*a1c2)
    dgd1c1term = -1.0*a11*dt*gd1c1**1.0*sin(b1c1)**2.0*sinh(2.0*a1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2**1.0*sin(b1c2)**2.0*sinh(2.0*a1c2)

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a11*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex14(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad1c2 - ad1n - dt*(a21*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sinh(2.0*a1c1)) + a22*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sinh(2.0*a1c2)))

    da1c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cosh(2.0*a1c1))
    da1c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cosh(2.0*a1c2))
    db1c1term = -a21*dt*(1.0*gd1c1**2.0*sin(b1c1)**1.0*cos(b1c1)*sinh(2.0*a1c1) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a22*dt*(1.0*gd1c2**2.0*sin(b1c2)**1.0*cos(b1c2)*sinh(2.0*a1c2) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a21*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a22*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 0.
    dad1c2term = 1.
    dbd1c1term = -1.0*a21*bd1c1**1.0*dt*sinh(2.0*a1c1)
    dbd1c2term = -1.0*a22*bd1c2**1.0*dt*sinh(2.0*a1c2)
    dgd1c1term = -1.0*a21*dt*gd1c1**1.0*sin(b1c1)**2.0*sinh(2.0*a1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2**1.0*sin(b1c2)**2.0*sinh(2.0*a1c2)

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a21*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex15(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd1c1 - bd1n - dt*(a11*(-2.0*ad1c1*bd1c1/tanh(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad1c2*bd1c2/tanh(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))))

    da1c1term = -a11*dt*(-2.0*ad1c1*bd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 2.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-3.0)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term = -a12*dt*(-2.0*ad1c2*bd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 2.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-3.0)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1c1term = -a11*dt*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a12*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a11*dt*(1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term = -a12*dt*(1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    da2c1term = -a11*dt*(lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term = -a12*dt*(lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2c1term = -a11*dt*(-1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term = -a12*dt*(-1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    dad1c1term = 2.0*a11*bd1c1*dt/tanh(a1c1)
    dad1c2term = 2.0*a12*bd1c2*dt/tanh(a1c2)
    dbd1c1term = 2.0*a11*ad1c1*dt/tanh(a1c1) + 1
    dbd1c2term = 2.0*a12*ad1c2*dt/tanh(a1c2)
    dgd1c1term = -1.0*a11*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2*sin(2.0*b1c2)

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a11*dt*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex16(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd1c2 - bd1n - dt*(a21*(-2.0*ad1c1*bd1c1/tanh(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad1c2*bd1c2/tanh(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))))

    da1c1term = -a21*dt*(-2.0*ad1c1*bd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 2.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-3.0)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term = -a22*dt*(-2.0*ad1c2*bd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 2.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-3.0)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1c1term = -a21*dt*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a22*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a21*dt*(1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term = -a22*dt*(1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    da2c1term = -a21*dt*(lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term = -a22*dt*(lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2c1term = -a21*dt*(-1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term = -a22*dt*(-1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    dad1c1term = 2.0*a21*bd1c1*dt/tanh(a1c1)
    dad1c2term = 2.0*a22*bd1c2*dt/tanh(a1c2)
    dbd1c1term = 2.0*a21*ad1c1*dt/tanh(a1c1)
    dbd1c2term = 2.0*a22*ad1c2*dt/tanh(a1c2) + 1
    dgd1c1term = -1.0*a21*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2*sin(2.0*b1c2)

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a21*dt*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex17(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad1c1*gd1c1/tanh(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad1c2*gd1c2/tanh(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))) + gd1c1 - gd1n

    da1c1term = -a11*dt*(-2.0*ad1c1*gd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 1.0*lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-2.0)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a12*dt*(-2.0*ad1c2*gd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 1.0*lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-2.0)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a11*dt*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 1.0*lamc1*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a12*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 1.0*lamc2*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a11*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a12*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a11*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*cosh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a12*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*cosh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a11*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a12*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a11*dt*(lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a12*dt*(lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 2.0*a11*dt*gd1c1/tanh(a1c1)
    dad1c2term = 2.0*a12*dt*gd1c2/tanh(a1c2)
    dbd1c1term = 2.0*a11*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a12*dt*gd1c2/tan(b1c2)
    dgd1c1term = -a11*dt*(-2.0*ad1c1/tanh(a1c1) - 2.0*bd1c1/tan(b1c1)) + 1
    dgd1c2term = -a12*dt*(-2.0*ad1c2/tanh(a1c2) - 2.0*bd1c2/tan(b1c2))

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a11*dt*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex18(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad1c1*gd1c1/tanh(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad1c2*gd1c2/tanh(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))) + gd1c2 - gd1n

    da1c1term = -a21*dt*(-2.0*ad1c1*gd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 1.0*lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-2.0)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a22*dt*(-2.0*ad1c2*gd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 1.0*lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-2.0)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a21*dt*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 1.0*lamc1*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a22*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 1.0*lamc2*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a21*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a22*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a21*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*cosh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a22*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*cosh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a21*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a22*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a21*dt*(lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a22*dt*(lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 2.0*a21*dt*gd1c1/tanh(a1c1)
    dad1c2term = 2.0*a22*dt*gd1c2/tanh(a1c2)
    dbd1c1term = 2.0*a21*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a22*dt*gd1c2/tan(b1c2)
    dgd1c1term = -a21*dt*(-2.0*ad1c1/tanh(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a22*dt*(-2.0*ad1c2/tanh(a1c2) - 2.0*bd1c2/tan(b1c2)) + 1

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = a21*dt*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex19(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad2c1 - ad2n - dt*(a11*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sinh(2.0*a2c1)) + a12*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sinh(2.0*a2c2)))

    da1c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a11*dt*(lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a12*dt*(lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cosh(2.0*a2c1))
    da2c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cosh(2.0*a2c2))
    db2c1term = -a11*dt*(1.0*gd2c1**2.0*sin(b2c1)**1.0*cos(b2c1)*sinh(2.0*a2c1) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a12*dt*(1.0*gd2c2**2.0*sin(b2c2)**1.0*cos(b2c2)*sinh(2.0*a2c2) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 1.
    dad2c2term = 0.
    dbd2c1term = -1.0*a11*bd2c1**1.0*dt*sinh(2.0*a2c1)
    dbd2c2term = -1.0*a12*bd2c2**1.0*dt*sinh(2.0*a2c2)
    dgd2c1term = -1.0*a11*dt*gd2c1**1.0*sin(b2c1)**2.0*sinh(2.0*a2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2**1.0*sin(b2c2)**2.0*sinh(2.0*a2c2)

    dlamc1term = a11*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex20(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad2c2 - ad2n - dt*(a21*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sinh(2.0*a2c1)) + a22*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sinh(2.0*a2c2)))

    da1c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a21*dt*(lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a22*dt*(lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cosh(2.0*a2c1))
    da2c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cosh(2.0*a2c2))
    db2c1term = -a21*dt*(1.0*gd2c1**2.0*sin(b2c1)**1.0*cos(b2c1)*sinh(2.0*a2c1) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a22*dt*(1.0*gd2c2**2.0*sin(b2c2)**1.0*cos(b2c2)*sinh(2.0*a2c2) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 1.
    dbd2c1term = -1.0*a21*bd2c1**1.0*dt*sinh(2.0*a2c1)
    dbd2c2term = -1.0*a22*bd2c2**1.0*dt*sinh(2.0*a2c2)
    dgd2c1term = -1.0*a21*dt*gd2c1**1.0*sin(b2c1)**2.0*sinh(2.0*a2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2**1.0*sin(b2c2)**2.0*sinh(2.0*a2c2)

    dlamc1term = a21*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex21(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd2c1 - bd2n - dt*(a11*(-2.0*ad2c1*bd2c1/tanh(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad2c2*bd2c2/tanh(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))))

    da1c1term = -a11*dt*(lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term = -a12*dt*(lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1c1term = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db1c2term = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1c1term = -a11*dt*(1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term = -a12*dt*(1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    da2c1term = -a11*dt*(-2.0*ad2c1*bd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 + 2.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-3.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term = -a12*dt*(-2.0*ad2c2*bd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 + 2.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-3.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2c1term = -a11*dt*(1.0*gd2c1**2*cos(2.0*b2c1) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term = -a12*dt*(1.0*gd2c2**2*cos(2.0*b2c2) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2c1term = -a11*dt*(-1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term = -a12*dt*(-1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 2.0*a11*bd2c1*dt/tanh(a2c1)
    dad2c2term = 2.0*a12*bd2c2*dt/tanh(a2c2)
    dbd2c1term = 2.0*a11*ad2c1*dt/tanh(a2c1) + 1
    dbd2c2term = 2.0*a12*ad2c2*dt/tanh(a2c2)
    dgd2c1term = -1.0*a11*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2*sin(2.0*b2c2)

    dlamc1term = a11*dt*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex22(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd2c2 - bd2n - dt*(a21*(-2.0*ad2c1*bd2c1/tanh(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad2c2*bd2c2/tanh(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))))

    da1c1term = -a21*dt*(lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term = -a22*dt*(lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1c1term = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db1c2term = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1c1term = -a21*dt*(1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term = -a22*dt*(1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    da2c1term = -a21*dt*(-2.0*ad2c1*bd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 + 2.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-3.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term = -a22*dt*(-2.0*ad2c2*bd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 + 2.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-3.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2c1term = -a21*dt*(1.0*gd2c1**2*cos(2.0*b2c1) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term = -a22*dt*(1.0*gd2c2**2*cos(2.0*b2c2) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2c1term = -a21*dt*(-1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term = -a22*dt*(-1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 2.0*a21*bd2c1*dt/tanh(a2c1)
    dad2c2term = 2.0*a22*bd2c2*dt/tanh(a2c2)
    dbd2c1term = 2.0*a21*ad2c1*dt/tanh(a2c1)
    dbd2c2term = 2.0*a22*ad2c2*dt/tanh(a2c2) + 1
    dgd2c1term = -1.0*a21*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2*sin(2.0*b2c2)

    dlamc1term = a21*dt*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex23(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad2c1*gd2c1/tanh(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad2c2*gd2c2/tanh(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))) + gd2c1 - gd2n

    da1c1term = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a2c1)**(-1.0)*cosh(a1c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a2c2)**(-1.0)*cosh(a1c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a11*dt*(-lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a12*dt*(-lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a11*dt*(-2.0*ad2c1*gd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-2.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a12*dt*(-2.0*ad2c2*gd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-2.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a11*dt*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a12*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 2.0*a11*dt*gd2c1/tanh(a2c1)
    dad2c2term = 2.0*a12*dt*gd2c2/tanh(a2c2)
    dbd2c1term = 2.0*a11*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a12*dt*gd2c2/tan(b2c2)
    dgd2c1term = -a11*dt*(-2.0*ad2c1/tanh(a2c1) - 2.0*bd2c1/tan(b2c1)) + 1
    dgd2c2term = -a12*dt*(-2.0*ad2c2/tanh(a2c2) - 2.0*bd2c2/tan(b2c2))

    dlamc1term = -a11*dt*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = -a12*dt*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex24(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad2c1*gd2c1/tanh(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad2c2*gd2c2/tanh(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))) + gd2c2 - gd2n

    da1c1term = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a2c1)**(-1.0)*cosh(a1c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a2c2)**(-1.0)*cosh(a1c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1c1term = -a21*dt*(-lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term = -a22*dt*(-lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1c1term = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    da2c1term = -a21*dt*(-2.0*ad2c1*gd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-2.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term = -a22*dt*(-2.0*ad2c2*gd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-2.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2c1term = -a21*dt*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term = -a22*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2c1term = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 2.0*a21*dt*gd2c1/tanh(a2c1)
    dad2c2term = 2.0*a22*dt*gd2c2/tanh(a2c2)
    dbd2c1term = 2.0*a21*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a22*dt*gd2c2/tan(b2c2)
    dgd2c1term = -a21*dt*(-2.0*ad2c1/tanh(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a22*dt*(-2.0*ad2c2/tanh(a2c2) - 2.0*bd2c2/tan(b2c2)) + 1

    dlamc1term = -a21*dt*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = -a22*dt*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex25(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -leq + arccosh(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))

    da1c1term = 0.
    da1c2term = (-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)
    db1c1term = 0.
    db1c2term = (sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)
    dg1c1term = 0.
    dg1c2term = sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)

    da2c1term = 0.
    da2c2term = (-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)
    db2c1term = 0.
    db2c2term = (-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)
    dg2c1term = 0.
    dg2c2term = -sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2 - 1)

    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.

    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def h3rads2rodex26(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)

    da1c1term = 0.
    da1c2term = -((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + ((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*cosh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*sinh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*cosh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    db1c1term = 0.
    db1c2term = -((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0/(2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + (-ad2c2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sinh(a1c2)*cosh(a2c2) + (-ad1c2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*cos(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(g1c2 - g2c2)*cos(b1c2) - (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*sin(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dg1c1term = 0.
    dg1c2term = -1.0*((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2) + (ad2c2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + (ad1c2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cosh(a1c2) + (bd2c2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2) + (bd1c2*sin(g1c2 - g2c2)*cos(b1c2) + (gd1c2 - gd2c2)*sin(b1c2)*cos(g1c2 - g2c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)

    da2c1term = 0.
    da2c2term = ((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*sinh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*cosh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1) - ((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))/(2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2))
    db2c1term = 0.
    db2c2term = -((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0/(2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + (-ad2c2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sinh(a1c2)*cosh(a2c2) + (-ad1c2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*cosh(a1c2) + (-(bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*sin(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*cos(b2c2))*sinh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dg2c1term = 0.
    dg2c2term = 1.0*((ad1c2 - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)))*sinh(a1c2)*cosh(a2c2) + ((-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2)) + ad2c2)*cosh(a1c2) + ((bd1c2 - bd2c2*cos(g1c2 - g2c2))*sin(b1c2)*cos(b2c2) + ((gd1c2 - gd2c2)*sin(b1c2)*sin(g1c2 - g2c2) + (-bd1c2*cos(g1c2 - g2c2) + bd2c2)*cos(b1c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2) + (-ad2c2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + (-ad1c2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cosh(a1c2) + (-bd2c2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2) + (-bd1c2*sin(g1c2 - g2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*cos(g1c2 - g2c2))*sin(b2c2))*sinh(a1c2))*sinh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)

    dad1c1term = 0.
    dad1c2term = ((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dbd1c1term = 0.
    dbd1c2term = (sin(b1c2)*cos(b2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dgd1c1term = 0.
    dgd1c2term = sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)

    dad2c1term = 0.
    dad2c2term = ((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dbd2c1term = 0.
    dbd2c2term = (-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) + sin(b2c2)*cos(b1c2))*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)
    dgd2c1term = 0.
    dgd2c2term = -sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)

    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

## RadauIIA s3 ##

def h3rads3rodex1(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2 + a13*ad1n1)

    da1c1term  = 1.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a11*dt
    dad1c2term = -a12*dt
    dad1n1term = -a13*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, 
                  db1c1term,db1c2term,db1n1term, 
                  dg1c1term,dg1c2term,dg1n1term, 
                  da2c1term,da2c2term,da2n1term, 
                  db2c1term,db2c2term,db2n1term, 
                  dg2c1term,dg2c2term,dg2n1term, 
                  dad1c1term,dad1c2term,dad1n1term, 
                  dbd1c1term,dbd1c2term,dbd1n1term, 
                  dgd1c1term,dgd1c2term,dgd1n1term, 
                  dad2c1term,dad2c2term,dad2n1term, 
                  dbd2c1term,dbd2c2term,dbd2n1term, 
                  dgd2c1term,dgd2c2term,dgd2n1term, 
                  dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex2(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a1c2 - a1n - dt*(a21*ad1c1 + a22*ad1c2 + a23*ad1n1)

    da1c1term  = 0.
    da1c2term  = 1.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a21*dt
    dad1c2term = -a22*dt
    dad1n1term = -a23*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex3(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -a1n + a1n1 - dt*(a31*ad1c1 + a32*ad1c2 + a33*ad1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 1.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a31*dt
    dad1c2term = -a32*dt
    dad1n1term = -a33*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex4(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b1c1 - b1n - dt*(a11*bd1c1 + a12*bd1c2 + a13*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 1.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a11*dt
    dbd1c2term = -a12*dt
    dbd1n1term = -a13*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex5(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b1c2 - b1n - dt*(a21*bd1c1 + a22*bd1c2 + a23*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 1.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a21*dt
    dbd1c2term = -a22*dt
    dbd1n1term = -a23*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex6(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -b1n + b1n1 - dt*(a31*bd1c1 + a32*bd1c2 + a33*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 1.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a31*dt
    dbd1c2term = -a32*dt
    dbd1n1term = -a33*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex7(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*gd1c1 + a12*gd1c2 + a13*gd1n1) + g1c1 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 1.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a11*dt
    dgd1c2term = -a12*dt
    dgd1n1term = -a13*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex8(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*gd1c1 + a22*gd1c2 + a23*gd1n1) + g1c2 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 1.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a21*dt
    dgd1c2term = -a22*dt
    dgd1n1term = -a23*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex9(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*gd1c1 + a32*gd1c2 + a33*gd1n1) - g1n + g1n1

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 1.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a31*dt
    dgd1c2term = -a32*dt
    dgd1n1term = -a33*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex10(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a2c1 - a2n - dt*(a11*ad2c1 + a12*ad2c2 + a13*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 1.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a11*dt
    dad2c2term = -a12*dt
    dad2n1term = -a13*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex11(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a2c2 - a2n - dt*(a21*ad2c1 + a22*ad2c2 + a23*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 1.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a21*dt
    dad2c2term = -a22*dt
    dad2n1term = -a23*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex12(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -a2n + a2n1 - dt*(a31*ad2c1 + a32*ad2c2 + a33*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 1.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a31*dt
    dad2c2term = -a32*dt
    dad2n1term = -a33*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex13(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b2c1 - b2n - dt*(a11*bd2c1 + a12*bd2c2 + a13*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 1.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a11*dt
    dbd2c2term = -a12*dt
    dbd2n1term = -a13*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex14(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b2c2 - b2n - dt*(a21*bd2c1 + a22*bd2c2 + a23*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 1.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a21*dt
    dbd2c2term = -a22*dt
    dbd2n1term = -a23*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex15(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -b2n + b2n1 - dt*(a31*bd2c1 + a32*bd2c2 + a33*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 1.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a31*dt
    dbd2c2term = -a32*dt
    dbd2n1term = -a33*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex16(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*gd2c1 + a12*gd2c2 + a13*gd2n1) + g2c1 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 1.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a11*dt
    dgd2c2term = -a12*dt
    dgd2n1term = -a13*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex17(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*gd2c1 + a22*gd2c2 + a23*gd2n1) + g2c2 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 1.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a21*dt
    dgd2c2term = -a22*dt
    dgd2n1term = -a23*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex18(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*gd2c1 + a32*gd2c2 + a33*gd2n1) - g2n + g2n1

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 1.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a31*dt
    dgd2c2term = -a32*dt
    dgd2n1term = -a33*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex19(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad1c1 - ad1n - dt*(a11*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sinh(2.0*a1c1)) + a12*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sinh(2.0*a1c2)) + a13*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1)))

    da1c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cosh(2.0*a1c1))
    da1c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cosh(2.0*a1c2))
    da1n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cosh(2.0*a1n1))
    db1c1term  = -a11*dt*(1.0*gd1c1**2.0*sin(b1c1)**1.0*cos(b1c1)*sinh(2.0*a1c1) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2.0*sin(b1c2)**1.0*cos(b1c2)*sinh(2.0*a1c2) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a13*dt*(1.0*gd1n1**2.0*sin(b1n1)**1.0*cos(b1n1)*sinh(2.0*a1n1) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a13*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a11*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a12*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a13*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a13*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 1.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -1.0*a11*bd1c1**1.0*dt*sinh(2.0*a1c1)
    dbd1c2term = -1.0*a12*bd1c2**1.0*dt*sinh(2.0*a1c2)
    dbd1n1term = -1.0*a13*bd1n1**1.0*dt*sinh(2.0*a1n1)
    dgd1c1term = -1.0*a11*dt*gd1c1**1.0*sin(b1c1)**2.0*sinh(2.0*a1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2**1.0*sin(b1c2)**2.0*sinh(2.0*a1c2)
    dgd1n1term = -1.0*a13*dt*gd1n1**1.0*sin(b1n1)**2.0*sinh(2.0*a1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a11*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a13*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex20(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad1c2 - ad1n - dt*(a21*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sinh(2.0*a1c1)) + a22*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sinh(2.0*a1c2)) + a23*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1)))

    da1c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cosh(2.0*a1c1))
    da1c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cosh(2.0*a1c2))
    da1n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cosh(2.0*a1n1))
    db1c1term  = -a21*dt*(1.0*gd1c1**2.0*sin(b1c1)**1.0*cos(b1c1)*sinh(2.0*a1c1) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2.0*sin(b1c2)**1.0*cos(b1c2)*sinh(2.0*a1c2) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a23*dt*(1.0*gd1n1**2.0*sin(b1n1)**1.0*cos(b1n1)*sinh(2.0*a1n1) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a23*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a21*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a22*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a23*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a23*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 1.
    dad1n1term = 0.
    dbd1c1term = -1.0*a21*bd1c1**1.0*dt*sinh(2.0*a1c1)
    dbd1c2term = -1.0*a22*bd1c2**1.0*dt*sinh(2.0*a1c2)
    dbd1n1term = -1.0*a23*bd1n1**1.0*dt*sinh(2.0*a1n1)
    dgd1c1term = -1.0*a21*dt*gd1c1**1.0*sin(b1c1)**2.0*sinh(2.0*a1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2**1.0*sin(b1c2)**2.0*sinh(2.0*a1c2)
    dgd1n1term = -1.0*a23*dt*gd1n1**1.0*sin(b1n1)**2.0*sinh(2.0*a1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a21*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a23*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex21(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -ad1n + ad1n1 - dt*(a31*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sinh(2.0*a1c1)) + a32*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sinh(2.0*a1c2)) + a33*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1)))

    da1c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cosh(2.0*a1c1))
    da1c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cosh(2.0*a1c2))
    da1n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cosh(2.0*a1n1))
    db1c1term  = -a31*dt*(1.0*gd1c1**2.0*sin(b1c1)**1.0*cos(b1c1)*sinh(2.0*a1c1) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a32*dt*(1.0*gd1c2**2.0*sin(b1c2)**1.0*cos(b1c2)*sinh(2.0*a1c2) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a33*dt*(1.0*gd1n1**2.0*sin(b1n1)**1.0*cos(b1n1)*sinh(2.0*a1n1) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a31*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a32*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a33*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a31*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a32*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a33*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a31*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a32*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a33*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 1.
    dbd1c1term = -1.0*a31*bd1c1**1.0*dt*sinh(2.0*a1c1)
    dbd1c2term = -1.0*a32*bd1c2**1.0*dt*sinh(2.0*a1c2)
    dbd1n1term = -1.0*a33*bd1n1**1.0*dt*sinh(2.0*a1n1)
    dgd1c1term = -1.0*a31*dt*gd1c1**1.0*sin(b1c1)**2.0*sinh(2.0*a1c1)
    dgd1c2term = -1.0*a32*dt*gd1c2**1.0*sin(b1c2)**2.0*sinh(2.0*a1c2)
    dgd1n1term = -1.0*a33*dt*gd1n1**1.0*sin(b1n1)**2.0*sinh(2.0*a1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a31*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + sinh(a1c1)*cosh(a2c1))/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a32*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + sinh(a1c2)*cosh(a2c2))/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a33*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex22(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd1c1 - bd1n - dt*(a11*(-2.0*ad1c1*bd1c1/tanh(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad1c2*bd1c2/tanh(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a13*(-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a11*dt*(-2.0*ad1c1*bd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 2.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-3.0)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*bd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 2.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-3.0)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a13*dt*(-2.0*ad1n1*bd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 2.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-3.0)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a11*dt*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a13*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a11*dt*(1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a12*dt*(1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a13*dt*(1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a11*dt*(lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a12*dt*(lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a13*dt*(lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a11*dt*(-1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a12*dt*(-1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a13*dt*(-1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 2.0*a11*bd1c1*dt/tanh(a1c1)
    dad1c2term = 2.0*a12*bd1c2*dt/tanh(a1c2)
    dad1n1term = 2.0*a13*bd1n1*dt/tanh(a1n1)
    dbd1c1term = 2.0*a11*ad1c1*dt/tanh(a1c1) + 1
    dbd1c2term = 2.0*a12*ad1c2*dt/tanh(a1c2)
    dbd1n1term = 2.0*a13*ad1n1*dt/tanh(a1n1)
    dgd1c1term = -1.0*a11*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a13*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a11*dt*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a13*dt*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex23(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd1c2 - bd1n - dt*(a21*(-2.0*ad1c1*bd1c1/tanh(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad1c2*bd1c2/tanh(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a23*(-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a21*dt*(-2.0*ad1c1*bd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 2.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-3.0)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*bd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 2.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-3.0)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a23*dt*(-2.0*ad1n1*bd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 2.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-3.0)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a21*dt*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a23*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a21*dt*(1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a22*dt*(1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a23*dt*(1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a21*dt*(lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a22*dt*(lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a23*dt*(lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a21*dt*(-1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a22*dt*(-1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a23*dt*(-1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 2.0*a21*bd1c1*dt/tanh(a1c1)
    dad1c2term = 2.0*a22*bd1c2*dt/tanh(a1c2)
    dad1n1term = 2.0*a23*bd1n1*dt/tanh(a1n1)
    dbd1c1term = 2.0*a21*ad1c1*dt/tanh(a1c1)
    dbd1c2term = 2.0*a22*ad1c2*dt/tanh(a1c2) + 1
    dbd1n1term = 2.0*a23*ad1n1*dt/tanh(a1n1)
    dgd1c1term = -1.0*a21*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a23*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a21*dt*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a23*dt*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex24(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -bd1n + bd1n1 - dt*(a31*(-2.0*ad1c1*bd1c1/tanh(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a32*(-2.0*ad1c2*bd1c2/tanh(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a33*(-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a31*dt*(-2.0*ad1c1*bd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 2.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-3.0)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a32*dt*(-2.0*ad1c2*bd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 2.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-3.0)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a33*dt*(-2.0*ad1n1*bd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 2.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-3.0)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a31*dt*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a32*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a33*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a31*dt*(1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a32*dt*(1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a33*dt*(1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a31*dt*(lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a32*dt*(lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a33*dt*(lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a1c1)**(-2.0)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a1c2)**(-2.0)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a31*dt*(-1.0*lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a32*dt*(-1.0*lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a33*dt*(-1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 2.0*a31*bd1c1*dt/tanh(a1c1)
    dad1c2term = 2.0*a32*bd1c2*dt/tanh(a1c2)
    dad1n1term = 2.0*a33*bd1n1*dt/tanh(a1n1)
    dbd1c1term = 2.0*a31*ad1c1*dt/tanh(a1c1)
    dbd1c2term = 2.0*a32*ad1c2*dt/tanh(a1c2)
    dbd1n1term = 2.0*a33*ad1n1*dt/tanh(a1n1) + 1
    dgd1c1term = -1.0*a31*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a32*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a33*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a31*dt*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a1c1)**(-2.0)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a32*dt*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a1c2)**(-2.0)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a33*dt*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex25(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad1c1*gd1c1/tanh(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad1c2*gd1c2/tanh(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a13*(-2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) + gd1c1 - gd1n

    da1c1term  = -a11*dt*(-2.0*ad1c1*gd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 1.0*lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-2.0)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*gd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 1.0*lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-2.0)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a13*dt*(-2.0*ad1n1*gd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 1.0*lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-2.0)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a11*dt*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 1.0*lamc1*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a12*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 1.0*lamc2*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a13*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 1.0*lamn1*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a11*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a12*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a13*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a11*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*cosh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a12*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*cosh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a13*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*cosh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a11*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a12*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a13*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a11*dt*(lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a12*dt*(lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a13*dt*(lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 2.0*a11*dt*gd1c1/tanh(a1c1)
    dad1c2term = 2.0*a12*dt*gd1c2/tanh(a1c2)
    dad1n1term = 2.0*a13*dt*gd1n1/tanh(a1n1)
    dbd1c1term = 2.0*a11*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a12*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a13*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a11*dt*(-2.0*ad1c1/tanh(a1c1) - 2.0*bd1c1/tan(b1c1)) + 1
    dgd1c2term = -a12*dt*(-2.0*ad1c2/tanh(a1c2) - 2.0*bd1c2/tan(b1c2))
    dgd1n1term = -a13*dt*(-2.0*ad1n1/tanh(a1n1) - 2.0*bd1n1/tan(b1n1))
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a11*dt*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a13*dt*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex26(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad1c1*gd1c1/tanh(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad1c2*gd1c2/tanh(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a23*(-2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) + gd1c2 - gd1n

    da1c1term  = -a21*dt*(-2.0*ad1c1*gd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 1.0*lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-2.0)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*gd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 1.0*lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-2.0)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a23*dt*(-2.0*ad1n1*gd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 1.0*lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-2.0)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a21*dt*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 1.0*lamc1*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a22*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 1.0*lamc2*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a23*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 1.0*lamn1*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a21*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a22*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a23*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a21*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*cosh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a22*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*cosh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a23*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*cosh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a21*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a22*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a23*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a21*dt*(lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a22*dt*(lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a23*dt*(lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 2.0*a21*dt*gd1c1/tanh(a1c1)
    dad1c2term = 2.0*a22*dt*gd1c2/tanh(a1c2)
    dad1n1term = 2.0*a23*dt*gd1n1/tanh(a1n1)
    dbd1c1term = 2.0*a21*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a22*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a23*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a21*dt*(-2.0*ad1c1/tanh(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a22*dt*(-2.0*ad1c2/tanh(a1c2) - 2.0*bd1c2/tan(b1c2)) + 1
    dgd1n1term = -a23*dt*(-2.0*ad1n1/tanh(a1n1) - 2.0*bd1n1/tan(b1n1))
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a21*dt*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a23*dt*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex27(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*(-2.0*ad1c1*gd1c1/tanh(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a32*(-2.0*ad1c2*gd1c2/tanh(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a33*(-2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) - gd1n + gd1n1

    da1c1term  = -a31*dt*(-2.0*ad1c1*gd1c1*(tanh(a1c1)**2 - 1)/tanh(a1c1)**2 + 1.0*lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-2.0)*sinh(a2c1)*cosh(a1c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a32*dt*(-2.0*ad1c2*gd1c2*(tanh(a1c2)**2 - 1)/tanh(a1c2)**2 + 1.0*lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-2.0)*sinh(a2c2)*cosh(a1c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a33*dt*(-2.0*ad1n1*gd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 1.0*lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-2.0)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a31*dt*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 1.0*lamc1*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a32*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 1.0*lamc2*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a33*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 1.0*lamn1*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a31*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a32*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a33*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a31*dt*(-lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*cosh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a32*dt*(-lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*cosh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a33*dt*(-lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*cosh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a31*dt*(lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(2*m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a32*dt*(lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(2*m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a33*dt*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a31*dt*(lamc1*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b2c1)**2*sin(g1c1 - g2c1)**2*sinh(a2c1)**2/(m1*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a32*dt*(lamc2*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b2c2)**2*sin(g1c2 - g2c2)**2*sinh(a2c2)**2/(m1*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a33*dt*(lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 2.0*a31*dt*gd1c1/tanh(a1c1)
    dad1c2term = 2.0*a32*dt*gd1c2/tanh(a1c2)
    dad1n1term = 2.0*a33*dt*gd1n1/tanh(a1n1)
    dbd1c1term = 2.0*a31*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a32*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a33*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a31*dt*(-2.0*ad1c1/tanh(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a32*dt*(-2.0*ad1c2/tanh(a1c2) - 2.0*bd1c2/tan(b1c2))
    dgd1n1term = -a33*dt*(-2.0*ad1n1/tanh(a1n1) - 2.0*bd1n1/tan(b1n1)) + 1
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a31*dt*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)**(-1.0)*sinh(a2c1)/(m1*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a32*dt*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)**(-1.0)*sinh(a2c2)/(m1*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a33*dt*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex28(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad2c1 - ad2n - dt*(a11*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sinh(2.0*a2c1)) + a12*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sinh(2.0*a2c2)) + a13*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1)))

    da1c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a11*dt*(lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a12*dt*(lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a13*dt*(lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a13*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cosh(2.0*a2c1))
    da2c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cosh(2.0*a2c2))
    da2n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cosh(2.0*a2n1))
    db2c1term  = -a11*dt*(1.0*gd2c1**2.0*sin(b2c1)**1.0*cos(b2c1)*sinh(2.0*a2c1) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2.0*sin(b2c2)**1.0*cos(b2c2)*sinh(2.0*a2c2) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a13*dt*(1.0*gd2n1**2.0*sin(b2n1)**1.0*cos(b2n1)*sinh(2.0*a2n1) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a13*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 1.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -1.0*a11*bd2c1**1.0*dt*sinh(2.0*a2c1)
    dbd2c2term = -1.0*a12*bd2c2**1.0*dt*sinh(2.0*a2c2)
    dbd2n1term = -1.0*a13*bd2n1**1.0*dt*sinh(2.0*a2n1)
    dgd2c1term = -1.0*a11*dt*gd2c1**1.0*sin(b2c1)**2.0*sinh(2.0*a2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2**1.0*sin(b2c2)**2.0*sinh(2.0*a2c2)
    dgd2n1term = -1.0*a13*dt*gd2n1**1.0*sin(b2n1)**2.0*sinh(2.0*a2n1)
    dlamc1term = a11*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a13*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex29(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad2c2 - ad2n - dt*(a21*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sinh(2.0*a2c1)) + a22*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sinh(2.0*a2c2)) + a23*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1)))

    da1c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a21*dt*(lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a22*dt*(lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a23*dt*(lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a23*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cosh(2.0*a2c1))
    da2c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cosh(2.0*a2c2))
    da2n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cosh(2.0*a2n1))
    db2c1term  = -a21*dt*(1.0*gd2c1**2.0*sin(b2c1)**1.0*cos(b2c1)*sinh(2.0*a2c1) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2.0*sin(b2c2)**1.0*cos(b2c2)*sinh(2.0*a2c2) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a23*dt*(1.0*gd2n1**2.0*sin(b2n1)**1.0*cos(b2n1)*sinh(2.0*a2n1) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a23*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 1.
    dad2n1term = 0.
    dbd2c1term = -1.0*a21*bd2c1**1.0*dt*sinh(2.0*a2c1)
    dbd2c2term = -1.0*a22*bd2c2**1.0*dt*sinh(2.0*a2c2)
    dbd2n1term = -1.0*a23*bd2n1**1.0*dt*sinh(2.0*a2n1)
    dgd2c1term = -1.0*a21*dt*gd2c1**1.0*sin(b2c1)**2.0*sinh(2.0*a2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2**1.0*sin(b2c2)**2.0*sinh(2.0*a2c2)
    dgd2n1term = -1.0*a23*dt*gd2n1**1.0*sin(b2n1)**2.0*sinh(2.0*a2n1)
    dlamc1term = a21*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a23*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex30(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -ad2n + ad2n1 - dt*(a31*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sinh(2.0*a2c1)) + a32*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sinh(2.0*a2c2)) + a33*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1)))

    da1c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*cosh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*cosh(a1c1)*cosh(a2c1) + sinh(a1c1)*sinh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*cosh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*cosh(a1c2)*cosh(a2c2) + sinh(a1c2)*sinh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a31*dt*(lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(sin(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) - sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a32*dt*(lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(sin(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) - sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a33*dt*(lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a31*dt*(-lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a32*dt*(-lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a33*dt*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cosh(2.0*a2c1))
    da2c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cosh(2.0*a2c2))
    da2n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cosh(2.0*a2n1))
    db2c1term  = -a31*dt*(1.0*gd2c1**2.0*sin(b2c1)**1.0*cos(b2c1)*sinh(2.0*a2c1) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a32*dt*(1.0*gd2c2**2.0*sin(b2c2)**1.0*cos(b2c2)*sinh(2.0*a2c2) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a33*dt*(1.0*gd2n1**2.0*sin(b2n1)**1.0*cos(b2n1)*sinh(2.0*a2n1) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a31*dt*(lamc1*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a32*dt*(lamc2*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a33*dt*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 1.
    dbd2c1term = -1.0*a31*bd2c1**1.0*dt*sinh(2.0*a2c1)
    dbd2c2term = -1.0*a32*bd2c2**1.0*dt*sinh(2.0*a2c2)
    dbd2n1term = -1.0*a33*bd2n1**1.0*dt*sinh(2.0*a2n1)
    dgd2c1term = -1.0*a31*dt*gd2c1**1.0*sin(b2c1)**2.0*sinh(2.0*a2c1)
    dgd2c2term = -1.0*a32*dt*gd2c2**1.0*sin(b2c2)**2.0*sinh(2.0*a2c2)
    dgd2n1term = -1.0*a33*dt*gd2n1**1.0*sin(b2n1)**2.0*sinh(2.0*a2n1)
    dlamc1term = a31*dt*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + sinh(a2c1)*cosh(a1c1))/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a32*dt*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + sinh(a2c2)*cosh(a1c2))/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a33*dt*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex31(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd2c1 - bd2n - dt*(a11*(-2.0*ad2c1*bd2c1/tanh(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad2c2*bd2c2/tanh(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a13*(-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a11*dt*(lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a12*dt*(lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a13*dt*(lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a11*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db1c2term  = -a12*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1n1term  = -a13*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg1c1term  = -a11*dt*(1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a12*dt*(1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a13*dt*(1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a11*dt*(-2.0*ad2c1*bd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 + 2.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-3.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*bd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 + 2.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-3.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a13*dt*(-2.0*ad2n1*bd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 + 2.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-3.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a11*dt*(1.0*gd2c1**2*cos(2.0*b2c1) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2*cos(2.0*b2c2) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a13*dt*(1.0*gd2n1**2*cos(2.0*b2n1) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a11*dt*(-1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a12*dt*(-1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a13*dt*(-1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a11*bd2c1*dt/tanh(a2c1)
    dad2c2term = 2.0*a12*bd2c2*dt/tanh(a2c2)
    dad2n1term = 2.0*a13*bd2n1*dt/tanh(a2n1)
    dbd2c1term = 2.0*a11*ad2c1*dt/tanh(a2c1) + 1
    dbd2c2term = 2.0*a12*ad2c2*dt/tanh(a2c2)
    dbd2n1term = 2.0*a13*ad2n1*dt/tanh(a2n1)
    dgd2c1term = -1.0*a11*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a13*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = a11*dt*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a12*dt*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a13*dt*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex32(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd2c2 - bd2n - dt*(a21*(-2.0*ad2c1*bd2c1/tanh(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad2c2*bd2c2/tanh(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a23*(-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a21*dt*(lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a22*dt*(lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a23*dt*(lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a21*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db1c2term  = -a22*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1n1term  = -a23*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg1c1term  = -a21*dt*(1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a22*dt*(1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a23*dt*(1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a21*dt*(-2.0*ad2c1*bd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 + 2.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-3.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*bd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 + 2.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-3.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a23*dt*(-2.0*ad2n1*bd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 + 2.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-3.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a21*dt*(1.0*gd2c1**2*cos(2.0*b2c1) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2*cos(2.0*b2c2) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a23*dt*(1.0*gd2n1**2*cos(2.0*b2n1) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a21*dt*(-1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a22*dt*(-1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a23*dt*(-1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a21*bd2c1*dt/tanh(a2c1)
    dad2c2term = 2.0*a22*bd2c2*dt/tanh(a2c2)
    dad2n1term = 2.0*a23*bd2n1*dt/tanh(a2n1)
    dbd2c1term = 2.0*a21*ad2c1*dt/tanh(a2c1)
    dbd2c2term = 2.0*a22*ad2c2*dt/tanh(a2c2) + 1
    dbd2n1term = 2.0*a23*ad2n1*dt/tanh(a2n1)
    dgd2c1term = -1.0*a21*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a23*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = a21*dt*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a22*dt*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a23*dt*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex33(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -bd2n + bd2n1 - dt*(a31*(-2.0*ad2c1*bd2c1/tanh(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a32*(-2.0*ad2c2*bd2c2/tanh(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a33*(-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))))

    da1c1term  = -a31*dt*(lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) + sin(b2c1)*cos(b1c1)*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da1c2term  = -a32*dt*(lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) + sin(b2c2)*cos(b1c2)*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da1n1term  = -a33*dt*(lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db1c1term  = -a31*dt*(-lamc1*(-sin(b1c1)*sin(b2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db1c2term  = -a32*dt*(-lamc2*(-sin(b1c2)*sin(b2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db1n1term  = -a33*dt*(-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg1c1term  = -a31*dt*(1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg1c2term  = -a32*dt*(1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg1n1term  = -a33*dt*(1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    da2c1term  = -a31*dt*(-2.0*ad2c1*bd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 + 2.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-3.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*cosh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    da2c2term  = -a32*dt*(-2.0*ad2c2*bd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 + 2.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-3.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*cosh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    da2n1term  = -a33*dt*(-2.0*ad2n1*bd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 + 2.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-3.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    db2c1term  = -a31*dt*(1.0*gd2c1**2*cos(2.0*b2c1) - lamc1*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sinh(a2c1)**(-2.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    db2c2term  = -a32*dt*(1.0*gd2c2**2*cos(2.0*b2c2) - lamc2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sinh(a2c2)**(-2.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    db2n1term  = -a33*dt*(1.0*gd2n1**2*cos(2.0*b2n1) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dg2c1term  = -a31*dt*(-1.0*lamc1*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    dg2c2term  = -a32*dt*(-1.0*lamc2*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    dg2n1term  = -a33*dt*(-1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a31*bd2c1*dt/tanh(a2c1)
    dad2c2term = 2.0*a32*bd2c2*dt/tanh(a2c2)
    dad2n1term = 2.0*a33*bd2n1*dt/tanh(a2n1)
    dbd2c1term = 2.0*a31*ad2c1*dt/tanh(a2c1)
    dbd2c2term = 2.0*a32*ad2c2*dt/tanh(a2c2)
    dbd2n1term = 2.0*a33*ad2n1*dt/tanh(a2n1) + 1
    dgd2c1term = -1.0*a31*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a32*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a33*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = a31*dt*(-sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*sinh(a2c1)**(-2.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = a32*dt*(-sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*sinh(a2c2)**(-2.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = a33*dt*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex34(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad2c1*gd2c1/tanh(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a12*(-2.0*ad2c2*gd2c2/tanh(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a13*(-2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) + gd2c1 - gd2n

    da1c1term  = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a2c1)**(-1.0)*cosh(a1c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a2c2)**(-1.0)*cosh(a1c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a13*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a2n1)**(-1.0)*cosh(a1n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a11*dt*(-lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a12*dt*(-lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a13*dt*(-lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a11*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a12*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a13*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a11*dt*(-2.0*ad2c1*gd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-2.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*gd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-2.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a13*dt*(-2.0*ad2n1*gd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-2.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a11*dt*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a12*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a13*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a11*dt*(-lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a12*dt*(-lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a13*dt*(-lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a11*dt*gd2c1/tanh(a2c1)
    dad2c2term = 2.0*a12*dt*gd2c2/tanh(a2c2)
    dad2n1term = 2.0*a13*dt*gd2n1/tanh(a2n1)
    dbd2c1term = 2.0*a11*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a12*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a13*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a11*dt*(-2.0*ad2c1/tanh(a2c1) - 2.0*bd2c1/tan(b2c1)) + 1
    dgd2c2term = -a12*dt*(-2.0*ad2c2/tanh(a2c2) - 2.0*bd2c2/tan(b2c2))
    dgd2n1term = -a13*dt*(-2.0*ad2n1/tanh(a2n1) - 2.0*bd2n1/tan(b2n1))
    dlamc1term = -a11*dt*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = -a12*dt*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = -a13*dt*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex35(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad2c1*gd2c1/tanh(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a22*(-2.0*ad2c2*gd2c2/tanh(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a23*(-2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) + gd2c2 - gd2n

    da1c1term  = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a2c1)**(-1.0)*cosh(a1c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a2c2)**(-1.0)*cosh(a1c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a23*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a2n1)**(-1.0)*cosh(a1n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a21*dt*(-lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a22*dt*(-lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a23*dt*(-lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a21*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a22*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a23*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a21*dt*(-2.0*ad2c1*gd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-2.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*gd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-2.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a23*dt*(-2.0*ad2n1*gd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-2.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a21*dt*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a22*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a23*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a21*dt*(-lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a22*dt*(-lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a23*dt*(-lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a21*dt*gd2c1/tanh(a2c1)
    dad2c2term = 2.0*a22*dt*gd2c2/tanh(a2c2)
    dad2n1term = 2.0*a23*dt*gd2n1/tanh(a2n1)
    dbd2c1term = 2.0*a21*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a22*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a23*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a21*dt*(-2.0*ad2c1/tanh(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a22*dt*(-2.0*ad2c2/tanh(a2c2) - 2.0*bd2c2/tan(b2c2)) + 1
    dgd2n1term = -a23*dt*(-2.0*ad2n1/tanh(a2n1) - 2.0*bd2n1/tan(b2n1))
    dlamc1term = -a21*dt*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = -a22*dt*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = -a23*dt*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex36(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*(-2.0*ad2c1*gd2c1/tanh(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))) + a32*(-2.0*ad2c2*gd2c2/tanh(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))) + a33*(-2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))) - gd2n + gd2n1

    da1c1term  = -a31*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a2c1)**(-1.0)*cosh(a1c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a2c1)*cosh(a1c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a2c1)*cosh(a1c1) + 2.0*sinh(a1c1)*cosh(a2c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da1c2term  = -a32*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a2c2)**(-1.0)*cosh(a1c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a2c2)*cosh(a1c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a2c2)*cosh(a1c2) + 2.0*sinh(a1c2)*cosh(a2c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da1n1term  = -a33*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a2n1)**(-1.0)*cosh(a1n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db1c1term  = -a31*dt*(-lamc1*(2.0*sin(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) - 2.0*sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) + lamc1*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db1c2term  = -a32*dt*(-lamc2*(2.0*sin(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) - 2.0*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) + lamc2*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db1n1term  = -a33*dt*(-lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg1c1term  = -a31*dt*(lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg1c2term  = -a32*dt*(lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg1n1term  = -a33*dt*(lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    da2c1term  = -a31*dt*(-2.0*ad2c1*gd2c1*(tanh(a2c1)**2 - 1)/tanh(a2c1)**2 - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-2.0)*cosh(a2c1)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) - lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*(-2.0*sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*cosh(a2c1) - 2.0*cos(b1c1)*cos(b2c1)*sinh(a1c1)*cosh(a2c1) + 2.0*sinh(a2c1)*cosh(a1c1))*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    da2c2term  = -a32*dt*(-2.0*ad2c2*gd2c2*(tanh(a2c2)**2 - 1)/tanh(a2c2)**2 - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-2.0)*cosh(a2c2)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) - lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*(-2.0*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*cosh(a2c2) - 2.0*cos(b1c2)*cos(b2c2)*sinh(a1c2)*cosh(a2c2) + 2.0*sinh(a2c2)*cosh(a1c2))*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    da2n1term  = -a33*dt*(-2.0*ad2n1*gd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-2.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    db2c1term  = -a31*dt*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - lamc1*(-2.0*sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) + 2.0*sin(b2c1)*cos(b1c1)*sinh(a1c1)*sinh(a2c1))*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(2*m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)) - 1.0*lamc1*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)))
    db2c2term  = -a32*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - lamc2*(-2.0*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) + 2.0*sin(b2c2)*cos(b1c2)*sinh(a1c2)*sinh(a2c2))*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(2*m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)) - 1.0*lamc2*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)))
    db2n1term  = -a33*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))
    dg2c1term  = -a31*dt*(-lamc1*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)) + 1.0*lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**1.0*sin(b1c1)**2*sin(g1c1 - g2c1)**2*sinh(a1c1)**2/(m2*((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1)**(3/2)))
    dg2c2term  = -a32*dt*(-lamc2*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)) + 1.0*lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**1.0*sin(b1c2)**2*sin(g1c2 - g2c2)**2*sinh(a1c2)**2/(m2*((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1)**(3/2)))
    dg2n1term  = -a33*dt*(-lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a31*dt*gd2c1/tanh(a2c1)
    dad2c2term = 2.0*a32*dt*gd2c2/tanh(a2c2)
    dad2n1term = 2.0*a33*dt*gd2n1/tanh(a2n1)
    dbd2c1term = 2.0*a31*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a32*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a33*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a31*dt*(-2.0*ad2c1/tanh(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a32*dt*(-2.0*ad2c2/tanh(a2c2) - 2.0*bd2c2/tan(b2c2))
    dgd2n1term = -a33*dt*(-2.0*ad2n1/tanh(a2n1) - 2.0*bd2n1/tan(b2n1)) + 1
    dlamc1term = -a31*dt*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1)**(-1.0)/(m2*sqrt((-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1)*sinh(a1c1)*sinh(a2c1) - cos(b1c1)*cos(b2c1)*sinh(a1c1)*sinh(a2c1) + cosh(a1c1)*cosh(a2c1))**2.0 - 1))
    dlamc2term = -a32*dt*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2)**(-1.0)/(m2*sqrt((-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2)*sinh(a1c2)*sinh(a2c2) - cos(b1c2)*cos(b2c2)*sinh(a1c2)*sinh(a2c2) + cosh(a1c2)*cosh(a2c2))**2.0 - 1))
    dlamn1term = -a33*dt*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex37(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -leq + arccosh(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = (sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = -sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2 - 1)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex38(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = -((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*cosh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*sinh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*cosh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = -((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + (-ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) + (-ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*cos(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1) - (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*sin(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = -1.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2) + (ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + (ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1) + (bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (bd1n1*sin(g1n1 - g2n1)*cos(b1n1) + (gd1n1 - gd2n1)*sin(b1n1)*cos(g1n1 - g2n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*sinh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*cosh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2))
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = -((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + (-ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a1n1)*cosh(a2n1) + (-ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*cosh(a1n1) + (-(bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*sin(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*cos(b2n1))*sinh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 1.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2) + (-ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + (-ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1) + (-bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-bd1n1*sin(g1n1 - g2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*cos(g1n1 - g2n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = ((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = ((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = -sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def h3rads3rodex39(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = (-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = (-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a2n1)*cosh(a1n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) + ad1n1**2.0*sinh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*cosh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) + ad2n1**2.0*sinh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(2.0*(ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*cosh(a1n1)*cosh(a2n1) + 2.0*((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*sinh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*cosh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*sinh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*cosh(a1n1)*cosh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cosh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*cosh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*sinh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cosh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-(-lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + 2.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-3.0)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (2.0*ad1n1*bd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 - 2.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-3.0)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (2.0*ad1n1*gd1n1*(tanh(a1n1)**2 - 1)/tanh(a1n1)**2 + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a2n1)**(-1.0)*cosh(a1n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-2.0)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd1n1**2.0*cos(b1n1)*cos(b2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*cos(b1n1)*cos(b2n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) + (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2))
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = -(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + (-2.0*ad1n1*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*cosh(a1n1)*cosh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1*cos(b1n1)*cos(b2n1) + bd2n1*sin(b1n1)*sin(b2n1) + bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1*cos(b1n1)*cos(b2n1) + bd2n1*sin(b1n1)*sin(b2n1) + bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) + (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) + (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-2.0*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) + 2.0*(-ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*cos(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1) - (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*sin(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a1n1)*cosh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(1.0*gd1n1**2.0*sin(b1n1)**1.0*cos(b1n1)*sinh(2.0*a1n1) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a2n1)*cosh(a1n1) + (lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a2n1)*cosh(a1n1) + (1.0*gd1n1**2.0*sin(b1n1)**1.0*cos(b1n1)*sinh(2.0*a1n1) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a1n1)*cosh(a2n1) + (2.0*bd1n1*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*bd2n1*sin(b2n1)*cos(b1n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - bd1n1**2.0*sin(b1n1)*cos(b2n1) + bd1n1**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*cos(b2n1) + bd2n1**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (gd1n1 - gd2n1)**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b2n1)*cos(b1n1) - (-1.0*gd1n1**2*cos(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad1n1*bd1n1/tanh(a1n1) - 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*cos(b1n1)*cos(b2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (2.0*ad2n1*bd2n1/tanh(a2n1) - 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1) - (2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 - lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(2.0*sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*ad2n1*gd2n1/tanh(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = (2.0*ad1n1*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) + ad1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) + ad2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(2.0*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*(ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1) + (bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (bd1n1*sin(g1n1 - g2n1)*cos(b1n1) + (gd1n1 - gd2n1)*sin(b1n1)*cos(g1n1 - g2n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + 2.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + (-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) + (-lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (2.0*bd1n1*bd2n1*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (-1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*ad2n1*gd2n1/tanh(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - 1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = (-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*cosh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*cosh(a1n1)*cosh(a2n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) + ad1n1**2.0*sinh(a2n1)*cosh(a1n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) + ad2n1**2.0*sinh(a2n1)*cosh(a1n1) - (2.0*(ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*sinh(a2n1) + 2.0*((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*cosh(a2n1))*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*cosh(a1n1)*cosh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*sinh(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cosh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*sinh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*cosh(a1n1)*cosh(a2n1) + sinh(a1n1)*sinh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*cosh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cosh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) + (-(-lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 + 2.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-3.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (2.0*ad2n1*bd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 - 2.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-3.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad2n1*gd2n1*(tanh(a2n1)**2 - 1)/tanh(a2n1)**2 - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-2.0)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*cosh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd1n1**2.0*cos(b1n1)*cos(b2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*cos(b1n1)*cos(b2n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) + (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - 2.0*cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2))
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = -(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/(2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + (-2.0*ad1n1*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*cosh(a1n1)*cosh(a2n1) - 2.0*ad1n1*(bd1n1*sin(b1n1)*sin(b2n1) + bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1*cos(b1n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a1n1)*sinh(a2n1) - 2.0*ad2n1*(bd1n1*sin(b1n1)*sin(b2n1) + bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1*cos(b1n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a1n1)*sinh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-2.0*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a1n1)*cosh(a2n1) + 2.0*(-ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*cosh(a1n1) + (-(bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*sin(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*cos(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a2n1)*cosh(a1n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(1.0*gd2n1**2.0*sin(b2n1)**1.0*cos(b2n1)*sinh(2.0*a2n1) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a1n1)*cosh(a2n1) + (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) + (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + sin(b2n1)*cos(b1n1)*sinh(a2n1)*cosh(a1n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a1n1)*cosh(a2n1) + (1.0*gd2n1**2.0*sin(b2n1)**1.0*cos(b2n1)*sinh(2.0*a2n1) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*cosh(a2n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a2n1)*cosh(a1n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*cos(b2n1) + 2.0*bd1n1*bd2n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) + bd1n1**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*sin(b2n1)*cos(b1n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + bd2n1**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*sin(b2n1)*cos(b1n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (lamn1*(-sin(b1n1)*sin(b2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a1n1)**(-2.0)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*cos(b2n1) - (-1.0*gd2n1**2*cos(2.0*b2n1) + lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b2n1)*cos(b1n1) - (1.0*gd2n1**2*cos(2.0*b2n1) - lamn1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sinh(a2n1)**(-2.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (2.0*ad1n1*bd1n1/tanh(a1n1) - 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad2n1*bd2n1/tanh(a2n1) - 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*cos(b1n1)*cos(b2n1) - (-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(2*m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - 1.0*lamn1*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*(-2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + 2.0*sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(2*m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*ad2n1*gd2n1/tanh(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = (-2.0*ad1n1*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1)*cosh(a2n1) - 2.0*ad1n1*(bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - 2.0*ad2n1*(bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-2.0*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + 2.0*(-ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cosh(a1n1) + (-bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-bd1n1*sin(g1n1 - g2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*cos(g1n1 - g2n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - 2.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**2 + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) - (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + (lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a1n1)*cosh(a2n1) + (lamn1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sinh(a2n1)*cosh(a1n1) + (-2.0*bd1n1*bd2n1*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (-1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (1.0*lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) - (-1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) + lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (1.0*lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b1n1)**2*sin(g1n1 - g2n1)**2*sinh(a1n1)**2/(m2*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 1.0*lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*sin(b2n1)**2*sin(g1n1 - g2n1)**2*sinh(a2n1)**2/(m1*((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + (2.0*ad1n1*gd1n1/tanh(a1n1) - 2.0*ad2n1*gd2n1/tanh(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + 1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*ad2n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad1n1**2.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) - ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + ad2n1**2.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a2n1)*cosh(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sinh(2.0*a1n1))*sinh(a1n1)*cosh(a2n1) + (-lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sinh(2.0*a2n1))*sinh(a2n1)*cosh(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tanh(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tanh(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tanh(a1n1) + 2.0*ad2n1*gd2n1/tanh(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - lamn1*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)**(3/2)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = (-2.0*ad1n1**1.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + 2.0*ad1n1**1.0*cosh(a1n1)*cosh(a2n1) - 2.0*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad2n1*sinh(a1n1)*sinh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(a2n1)*cosh(a1n1) + 2.0*sinh(a1n1)*cosh(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (-2.0*bd1n1*sin(b1n1)*cos(b2n1)/tanh(a1n1) + 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/tanh(a1n1) - 2.0*gd1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tanh(a1n1))*sinh(a1n1)*sinh(a2n1) + (2.0*bd1n1*sin(b1n1)*cos(b2n1) - 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - 2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*sin(b2n1)*cos(b1n1) + 2.0*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = (-2.0*ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a2n1)*cosh(a1n1) - 2.0*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1) + 1.0*bd1n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(2.0*a1n1)*sinh(a2n1)*cosh(a1n1) + 1.0*bd1n1**1.0*sinh(a1n1)*sinh(2.0*a1n1)*cosh(a2n1) - 2.0*(sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (-2.0*ad1n1*sin(b1n1)*cos(b2n1)/tanh(a1n1) + 2.0*ad1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/tanh(a1n1) + 2.0*bd1n1**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1**1.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*gd1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(b1n1) - (-2.0*gd1n1 + 2.0*gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = (2.0*ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) + 2.0*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + 1.0*gd1n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(b1n1)**2.0*sinh(2.0*a1n1)*sinh(a2n1)*cosh(a1n1) + 1.0*gd1n1**1.0*sin(b1n1)**2.0*sinh(a1n1)*sinh(2.0*a1n1)*cosh(a2n1) - 2.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (2.0*bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + 2.0*bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + 1.0*gd1n1*sin(b1n1)*sin(2.0*b1n1)*cos(b2n1) - 1.0*gd1n1*sin(2.0*b1n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*(gd1n1 - gd2n1)**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad1n1/tanh(a1n1) + 2.0*bd1n1/tan(b1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = (-2.0*ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cosh(a1n1)*cosh(a2n1) + 2.0*ad1n1*sinh(a1n1)*sinh(a2n1) - 2.0*ad2n1**1.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1) + 2.0*ad2n1**1.0*cosh(a1n1)*cosh(a2n1) - ((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(2.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(a1n1)*cosh(a2n1) + 2.0*sinh(a2n1)*cosh(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/tanh(a2n1) - 2.0*bd2n1*sin(b2n1)*cos(b1n1)/tanh(a2n1) + 2.0*gd2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tanh(a2n1))*sinh(a1n1)*sinh(a2n1) + (2.0*bd1n1*sin(b1n1)*cos(b2n1) - 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - 2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*sin(b2n1)*cos(b1n1) + 2.0*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*cosh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = (-2.0*ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a2n1)*cosh(a1n1) - 2.0*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sinh(a1n1)*cosh(a2n1) + 1.0*bd2n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sinh(a1n1)*sinh(2.0*a2n1)*cosh(a2n1) + 1.0*bd2n1**1.0*sinh(a2n1)*sinh(2.0*a2n1)*cosh(a1n1) - 2.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (2.0*ad2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/tanh(a2n1) - 2.0*ad2n1*sin(b2n1)*cos(b1n1)/tanh(a2n1) - 2.0*bd1n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1**1.0*cos(b1n1)*cos(b2n1) + 2.0*gd2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(b2n1) - (-2.0*gd1n1 + 2.0*gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = (-2.0*ad1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - 2.0*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) + 1.0*gd2n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(b2n1)**2.0*sinh(a1n1)*sinh(2.0*a2n1)*cosh(a2n1) + 1.0*gd2n1**1.0*sin(b2n1)**2.0*sinh(a2n1)*sinh(2.0*a2n1)*cosh(a1n1) + 2.0*((ad1n1 - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)))*sinh(a1n1)*cosh(a2n1) + ((-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1)) + ad2n1)*cosh(a1n1) + ((bd1n1 - bd2n1*cos(g1n1 - g2n1))*sin(b1n1)*cos(b2n1) + ((gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1) + (-bd1n1*cos(g1n1 - g2n1) + bd2n1)*cos(b1n1))*sin(b2n1))*sinh(a1n1))*sinh(a2n1))**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)/((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1) + (-2.0*bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - 2.0*bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - 1.0*gd2n1*sin(b1n1)*sin(2.0*b2n1)*cos(b2n1)*cos(g1n1 - g2n1) + 1.0*gd2n1*sin(b2n1)*sin(2.0*b2n1)*cos(b1n1) - 2.0*(gd1n1 - gd2n1)**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1/tanh(a2n1) - 2.0*bd2n1/tan(b2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sinh(a1n1)*sinh(a2n1))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = ((-(sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1)**(-1.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*sinh(a1n1)**(-1.0)*sinh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) + sin(b2n1)*cos(b1n1)*sinh(a1n1)*sinh(a2n1))*sin(b2n1)*cos(b1n1)*sinh(a2n1)**(-2.0)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - (sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sin(b1n1)*cos(b2n1)*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) + (sin(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)*sinh(a1n1)**(-2.0)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))*sinh(a1n1)*sinh(a2n1) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sinh(a1n1)*cosh(a2n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*cosh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*cosh(a2n1) + sinh(a2n1)*cosh(a1n1))*sinh(a2n1)*cosh(a1n1)/(m2*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sinh(a2n1)*cosh(a1n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a2n1)*cosh(a1n1) - cos(b1n1)*cos(b2n1)*sinh(a2n1)*cosh(a1n1) + sinh(a1n1)*cosh(a2n1))*sinh(a1n1)*cosh(a2n1)/(m1*sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)))/sqrt((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1)*sinh(a1n1)*sinh(a2n1) - cos(b1n1)*cos(b2n1)*sinh(a1n1)*sinh(a2n1) + cosh(a1n1)*cosh(a2n1))**2.0 - 1)

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]


###############
##### S3 ######
###############

## Rigid Rod ##

## RadauIIA s2 ##

def s3rads2rodex1(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2)

    da1c1term  = 1.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = -a11*dt
    dad1c2term = -a12*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex2(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a1c2 - a1n - dt*(a21*ad1c1 + a22*ad1c2)

    da1c1term  = 0.
    da1c2term  = 1.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = -a21*dt
    dad1c2term = -a22*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex3(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b1c1 - b1n - dt*(a11*bd1c1 + a12*bd1c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 1.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = -a11*dt
    dbd1c2term = -a12*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex4(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b1c2 - b1n - dt*(a21*bd1c1 + a22*bd1c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 1.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = -a21*dt
    dbd1c2term = -a22*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex5(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*gd1c1 + a12*gd1c2) + g1c1 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 1.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = -a11*dt
    dgd1c2term = -a12*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex6(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*gd1c1 + a22*gd1c2) + g1c2 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 1.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = -a21*dt
    dgd1c2term = -a22*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex7(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a2c1 - a2n - dt*(a11*ad2c1 + a12*ad2c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 1.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = -a11*dt
    dad2c2term = -a12*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex8(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = a2c2 - a2n - dt*(a21*ad2c1 + a22*ad2c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 1.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = -a21*dt
    dad2c2term = -a22*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex9(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b2c1 - b2n - dt*(a11*bd2c1 + a12*bd2c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 1.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = -a11*dt
    dbd2c2term = -a12*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex10(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = b2c2 - b2n - dt*(a21*bd2c1 + a22*bd2c2)

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 1.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = -a21*dt
    dbd2c2term = -a22*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex11(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*gd2c1 + a12*gd2c2) + g2c1 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 1.
    dg2c2term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = -a11*dt
    dgd2c2term = -a12*dt
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex12(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*gd2c1 + a22*gd2c2) + g2c2 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 1.
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = -a21*dt
    dgd2c2term = -a22*dt
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex13(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad1c1 - ad1n - dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sin(2.0*a1c1)) + a12*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sin(2.0*a1c2)))

    da1c1term  = -dt*(a11*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cos(2.0*a1c1)) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cos(2.0*a1c2))
    db1c1term  = -dt*(a11*(1.0*gd1c1**2.0*sin(2.0*a1c1)*sin(b1c1)**1.0*cos(b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2.0*sin(2.0*a1c2)*sin(b1c2)**1.0*cos(b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 1.
    dad1c2term = 0.
    dbd1c1term = -1.0*a11*bd1c1**1.0*dt*sin(2.0*a1c1)
    dbd1c2term = -1.0*a12*bd1c2**1.0*dt*sin(2.0*a1c2)
    dgd1c1term = -1.0*a11*dt*gd1c1**1.0*sin(2.0*a1c1)*sin(b1c1)**2.0
    dgd1c2term = -1.0*a12*dt*gd1c2**1.0*sin(2.0*a1c2)*sin(b1c2)**2.0
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = -a11*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex14(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad1c2 - ad1n - dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sin(2.0*a1c1)) + a22*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sin(2.0*a1c2)))

    da1c1term  = -dt*(a21*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cos(2.0*a1c1)) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cos(2.0*a1c2))
    db1c1term  = -dt*(a21*(1.0*gd1c1**2.0*sin(2.0*a1c1)*sin(b1c1)**1.0*cos(b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2.0*sin(2.0*a1c2)*sin(b1c2)**1.0*cos(b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 1.
    dbd1c1term = -1.0*a21*bd1c1**1.0*dt*sin(2.0*a1c1)
    dbd1c2term = -1.0*a22*bd1c2**1.0*dt*sin(2.0*a1c2)
    dgd1c1term = -1.0*a21*dt*gd1c1**1.0*sin(2.0*a1c1)*sin(b1c1)**2.0
    dgd1c2term = -1.0*a22*dt*gd1c2**1.0*sin(2.0*a1c2)*sin(b1c2)**2.0
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = -a21*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex15(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd1c1 - bd1n - dt*(a11*(-2.0*ad1c1*bd1c1/tan(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad1c2*bd1c2/tan(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a11*(-2.0*ad1c1*bd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-2.0)*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*bd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 - 1.0*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-2.0)*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a11*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))**2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a11*bd1c1*dt/tan(a1c1)
    dad1c2term = 2.0*a12*bd1c2*dt/tan(a1c2)
    dbd1c1term = 2.0*a11*ad1c1*dt/tan(a1c1) + 1
    dbd1c2term = 2.0*a12*ad1c2*dt/tan(a1c2)
    dgd1c1term = -1.0*a11*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2*sin(2.0*b1c2)
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = -a11*dt*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex16(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd1c2 - bd1n - dt*(a21*(-2.0*ad1c1*bd1c1/tan(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad1c2*bd1c2/tan(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a21*(-2.0*ad1c1*bd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-2.0)*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*bd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 - 1.0*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-2.0)*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a21*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))**2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a21*bd1c1*dt/tan(a1c1)
    dad1c2term = 2.0*a22*bd1c2*dt/tan(a1c2)
    dbd1c1term = 2.0*a21*ad1c1*dt/tan(a1c1)
    dbd1c2term = 2.0*a22*ad1c2*dt/tan(a1c2) + 1
    dgd1c1term = -1.0*a21*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2*sin(2.0*b1c2)
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = -a21*dt*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex17(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad1c1*gd1c1/tan(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad1c2*gd1c2/tan(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd1c1 - gd1n

    da1c1term  = -dt*(a11*(-2.0*ad1c1*gd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 + 1.0*lamc1*sin(a1c1)**(-2.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*gd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 + 1.0*lamc2*sin(a1c2)**(-2.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a11*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + 1.0*lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + 1.0*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a11*dt*gd1c1/tan(a1c1)
    dad1c2term = 2.0*a12*dt*gd1c2/tan(a1c2)
    dbd1c1term = 2.0*a11*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a12*dt*gd1c2/tan(b1c2)
    dgd1c1term = -a11*dt*(-2.0*ad1c1/tan(a1c1) - 2.0*bd1c1/tan(b1c1)) + 1
    dgd1c2term = -a12*dt*(-2.0*ad1c2/tan(a1c2) - 2.0*bd1c2/tan(b1c2))
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = a11*dt*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = a12*dt*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex18(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad1c1*gd1c1/tan(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad1c2*gd1c2/tan(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd1c2 - gd1n

    da1c1term  = -dt*(a21*(-2.0*ad1c1*gd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 + 1.0*lamc1*sin(a1c1)**(-2.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*gd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 + 1.0*lamc2*sin(a1c2)**(-2.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a21*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + 1.0*lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + 1.0*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a21*dt*gd1c1/tan(a1c1)
    dad1c2term = 2.0*a22*dt*gd1c2/tan(a1c2)
    dbd1c1term = 2.0*a21*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a22*dt*gd1c2/tan(b1c2)
    dgd1c1term = -a21*dt*(-2.0*ad1c1/tan(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a22*dt*(-2.0*ad1c2/tan(a1c2) - 2.0*bd1c2/tan(b1c2)) + 1
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = a21*dt*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = a22*dt*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex19(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad2c1 - ad2n - dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sin(2.0*a2c1)) + a12*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sin(2.0*a2c2)))

    da1c1term  = -dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cos(2.0*a2c1)) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cos(2.0*a2c2))
    db2c1term  = -dt*(a11*(1.0*gd2c1**2.0*sin(2.0*a2c1)*sin(b2c1)**1.0*cos(b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2.0*sin(2.0*a2c2)*sin(b2c2)**1.0*cos(b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 1.
    dad2c2term = 0.
    dbd2c1term = -1.0*a11*bd2c1**1.0*dt*sin(2.0*a2c1)
    dbd2c2term = -1.0*a12*bd2c2**1.0*dt*sin(2.0*a2c2)
    dgd2c1term = -1.0*a11*dt*gd2c1**1.0*sin(2.0*a2c1)*sin(b2c1)**2.0
    dgd2c2term = -1.0*a12*dt*gd2c2**1.0*sin(2.0*a2c2)*sin(b2c2)**2.0
    dlamc1term = -a11*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex20(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = ad2c2 - ad2n - dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sin(2.0*a2c1)) + a22*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sin(2.0*a2c2)))

    da1c1term  = -dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cos(2.0*a2c1)) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cos(2.0*a2c2))
    db2c1term  = -dt*(a21*(1.0*gd2c1**2.0*sin(2.0*a2c1)*sin(b2c1)**1.0*cos(b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2.0*sin(2.0*a2c2)*sin(b2c2)**1.0*cos(b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 1.
    dbd2c1term = -1.0*a21*bd2c1**1.0*dt*sin(2.0*a2c1)
    dbd2c2term = -1.0*a22*bd2c2**1.0*dt*sin(2.0*a2c2)
    dgd2c1term = -1.0*a21*dt*gd2c1**1.0*sin(2.0*a2c1)*sin(b2c1)**2.0
    dgd2c2term = -1.0*a22*dt*gd2c2**1.0*sin(2.0*a2c2)*sin(b2c2)**2.0
    dlamc1term = -a21*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex21(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd2c1 - bd2n - dt*(a11*(-2.0*ad2c1*bd2c1/tan(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad2c2*bd2c2/tan(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a11*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**(-1.0)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)**(-1.0)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-2.0*ad2c1*bd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-2.0)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*bd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-2.0)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a11*(1.0*gd2c1**2*cos(2.0*b2c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))**2*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2*cos(2.0*b2c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 2.0*a11*bd2c1*dt/tan(a2c1)
    dad2c2term = 2.0*a12*bd2c2*dt/tan(a2c2)
    dbd2c1term = 2.0*a11*ad2c1*dt/tan(a2c1) + 1
    dbd2c2term = 2.0*a12*ad2c2*dt/tan(a2c2)
    dgd2c1term = -1.0*a11*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2*sin(2.0*b2c2)
    dlamc1term = -a11*dt*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex22(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = bd2c2 - bd2n - dt*(a21*(-2.0*ad2c1*bd2c1/tan(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad2c2*bd2c2/tan(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a21*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**(-1.0)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)**(-1.0)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-2.0*ad2c1*bd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-2.0)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*bd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-2.0)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a21*(1.0*gd2c1**2*cos(2.0*b2c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))**2*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2*cos(2.0*b2c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 2.0*a21*bd2c1*dt/tan(a2c1)
    dad2c2term = 2.0*a22*bd2c2*dt/tan(a2c2)
    dbd2c1term = 2.0*a21*ad2c1*dt/tan(a2c1)
    dbd2c2term = 2.0*a22*ad2c2*dt/tan(a2c2) + 1
    dgd2c1term = -1.0*a21*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2*sin(2.0*b2c2)
    dlamc1term = -a21*dt*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex23(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad2c1*gd2c1/tan(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad2c2*gd2c2/tan(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd2c1 - gd2n

    da1c1term  = -dt*(a11*(lamc1*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-2.0*ad2c1*gd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-2.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*gd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-2.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a11*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 2.0*a11*dt*gd2c1/tan(a2c1)
    dad2c2term = 2.0*a12*dt*gd2c2/tan(a2c2)
    dbd2c1term = 2.0*a11*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a12*dt*gd2c2/tan(b2c2)
    dgd2c1term = -a11*dt*(-2.0*ad2c1/tan(a2c1) - 2.0*bd2c1/tan(b2c1)) + 1
    dgd2c2term = -a12*dt*(-2.0*ad2c2/tan(a2c2) - 2.0*bd2c2/tan(b2c2))
    dlamc1term = -a11*dt*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex24(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad2c1*gd2c1/tan(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad2c2*gd2c2/tan(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd2c2 - gd2n

    da1c1term  = -dt*(a21*(lamc1*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-2.0*ad2c1*gd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-2.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*gd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-2.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a21*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 2.0*a21*dt*gd2c1/tan(a2c1)
    dad2c2term = 2.0*a22*dt*gd2c2/tan(a2c2)
    dbd2c1term = 2.0*a21*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a22*dt*gd2c2/tan(b2c2)
    dgd2c1term = -a21*dt*(-2.0*ad2c1/tan(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a22*dt*(-2.0*ad2c2/tan(a2c2) - 2.0*bd2c2/tan(b2c2)) + 1
    dlamc1term = -a21*dt*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex25(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = -leq + arccos((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))

    da1c1term  = 0.
    da1c2term  = -((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    db1c1term  = 0.
    db1c2term  = -(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    dg1c1term  = 0.
    dg1c2term  = sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    da2c1term  = 0.
    da2c2term  = -((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    db2c1term  = 0.
    db2c2term  = -(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    dg2c1term  = 0.
    dg2c2term  = -sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2)
    dad1c1term = 0.
    dad1c2term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

def s3rads2rodex26(stepn,stepc1,stepc2,dt,params):
    # Set to run RadauIIA 2-stage method
    a11,a12 = [5./12., -1./12.]
    a21,a22 = [3./4., 1./4.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    m1,m2,leq = params

    mainterm = (ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)

    da1c1term  = 0.
    da1c2term  = (-ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - ad1c2*cos(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + ad2c2*sin(a1c2)*sin(a2c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a2c2)*cos(a1c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) + ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(2.0*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - 2.0*sin(a1c2)*cos(a2c2))*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))/(2*(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2))
    db1c1term  = 0.
    db1c2term  = (ad1c2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2) + ad2c2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2) + (-bd1c2*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - bd1c2*cos(b1c2)*cos(b2c2) + bd2c2*sin(b1c2)*sin(b2c2) + bd2c2*cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) + (-gd1c2 + gd2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) + 1.0*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))*sin(a1c2)*sin(a2c2)/(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2)
    dg1c1term  = 0.
    dg1c2term  = (-ad1c2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2) - ad2c2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2) + (-bd1c2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2) - bd2c2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2) + (-gd1c2 + gd2c2)*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) - 1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))*sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2)
    da2c1term  = 0.
    da2c2term  = (ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + ad1c2*sin(a1c2)*sin(a2c2) - ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - ad2c2*cos(a1c2)*cos(a2c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*cos(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) + ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(2.0*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - 2.0*sin(a2c2)*cos(a1c2))*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))/(2*(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2))
    db2c1term  = 0.
    db2c2term  = (ad1c2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2) + ad2c2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2) + (bd1c2*sin(b1c2)*sin(b2c2) + bd1c2*cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - bd2c2*cos(b1c2)*cos(b2c2) + (-gd1c2 + gd2c2)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2))*sin(a1c2)*sin(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) + 1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))*sin(a1c2)*sin(a2c2)/(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2)
    dg2c1term  = 0.
    dg2c2term  = (ad1c2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2) + ad2c2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2) + (bd1c2*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2) + bd2c2*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2) - (-gd1c2 + gd2c2)*sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0) + 1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**1.0*(ad1c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - ad1c2*sin(a1c2)*cos(a2c2) + ad2c2*(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - ad2c2*sin(a2c2)*cos(a1c2) + (-bd1c2*sin(b1c2)*cos(b2c2) + bd1c2*sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2) + bd2c2*sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - bd2c2*sin(b2c2)*cos(b1c2) - (gd1c2 - gd2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2))*sin(a1c2)*sin(a2c2))*sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)**(3/2)
    dad1c1term = 0.
    dad1c2term = ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dbd1c1term = 0.
    dbd1c2term = (-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dgd1c1term = 0.
    dgd1c2term = -sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dad2c1term = 0.
    dad2c2term = ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dbd2c1term = 0.
    dbd2c2term = (sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dgd2c1term = 0.
    dgd2c2term = sin(a1c2)*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)/sqrt(1 - ((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) + cos(a1c2)*cos(a2c2))**2.0)
    dlamc1term = 0.
    dlamc2term = 0.

    derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

    return [mainterm, derivterms]

## RadauIIA s3 ##

def s3rads3rodex1(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2 + a13*ad1n1)

    da1c1term  = 1.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a11*dt
    dad1c2term = -a12*dt
    dad1n1term = -a13*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, 
                  db1c1term,db1c2term,db1n1term, 
                  dg1c1term,dg1c2term,dg1n1term, 
                  da2c1term,da2c2term,da2n1term, 
                  db2c1term,db2c2term,db2n1term, 
                  dg2c1term,dg2c2term,dg2n1term, 
                  dad1c1term,dad1c2term,dad1n1term, 
                  dbd1c1term,dbd1c2term,dbd1n1term, 
                  dgd1c1term,dgd1c2term,dgd1n1term, 
                  dad2c1term,dad2c2term,dad2n1term, 
                  dbd2c1term,dbd2c2term,dbd2n1term, 
                  dgd2c1term,dgd2c2term,dgd2n1term, 
                  dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex2(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a1c2 - a1n - dt*(a21*ad1c1 + a22*ad1c2 + a23*ad1n1)

    da1c1term  = 0.
    da1c2term  = 1.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a21*dt
    dad1c2term = -a22*dt
    dad1n1term = -a23*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex3(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -a1n + a1n1 - dt*(a31*ad1c1 + a32*ad1c2 + a33*ad1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 1.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = -a31*dt
    dad1c2term = -a32*dt
    dad1n1term = -a33*dt
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex4(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b1c1 - b1n - dt*(a11*bd1c1 + a12*bd1c2 + a13*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 1.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a11*dt
    dbd1c2term = -a12*dt
    dbd1n1term = -a13*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex5(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b1c2 - b1n - dt*(a21*bd1c1 + a22*bd1c2 + a23*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 1.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a21*dt
    dbd1c2term = -a22*dt
    dbd1n1term = -a23*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex6(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -b1n + b1n1 - dt*(a31*bd1c1 + a32*bd1c2 + a33*bd1n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 1.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -a31*dt
    dbd1c2term = -a32*dt
    dbd1n1term = -a33*dt
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex7(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*gd1c1 + a12*gd1c2 + a13*gd1n1) + g1c1 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 1.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a11*dt
    dgd1c2term = -a12*dt
    dgd1n1term = -a13*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex8(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*gd1c1 + a22*gd1c2 + a23*gd1n1) + g1c2 - g1n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 1.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a21*dt
    dgd1c2term = -a22*dt
    dgd1n1term = -a23*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex9(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*gd1c1 + a32*gd1c2 + a33*gd1n1) - g1n + g1n1

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 1.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = -a31*dt
    dgd1c2term = -a32*dt
    dgd1n1term = -a33*dt
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex10(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a2c1 - a2n - dt*(a11*ad2c1 + a12*ad2c2 + a13*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 1.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a11*dt
    dad2c2term = -a12*dt
    dad2n1term = -a13*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex11(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = a2c2 - a2n - dt*(a21*ad2c1 + a22*ad2c2 + a23*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 1.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a21*dt
    dad2c2term = -a22*dt
    dad2n1term = -a23*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex12(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -a2n + a2n1 - dt*(a31*ad2c1 + a32*ad2c2 + a33*ad2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 1.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = -a31*dt
    dad2c2term = -a32*dt
    dad2n1term = -a33*dt
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex13(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b2c1 - b2n - dt*(a11*bd2c1 + a12*bd2c2 + a13*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 1.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a11*dt
    dbd2c2term = -a12*dt
    dbd2n1term = -a13*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex14(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = b2c2 - b2n - dt*(a21*bd2c1 + a22*bd2c2 + a23*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 1.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a21*dt
    dbd2c2term = -a22*dt
    dbd2n1term = -a23*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex15(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -b2n + b2n1 - dt*(a31*bd2c1 + a32*bd2c2 + a33*bd2n1)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 1.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -a31*dt
    dbd2c2term = -a32*dt
    dbd2n1term = -a33*dt
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex16(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*gd2c1 + a12*gd2c2 + a13*gd2n1) + g2c1 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 1.
    dg2c2term  = 0.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a11*dt
    dgd2c2term = -a12*dt
    dgd2n1term = -a13*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex17(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*gd2c1 + a22*gd2c2 + a23*gd2n1) + g2c2 - g2n

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 1.
    dg2n1term  = 0.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a21*dt
    dgd2c2term = -a22*dt
    dgd2n1term = -a23*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex18(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*gd2c1 + a32*gd2c2 + a33*gd2n1) - g2n + g2n1

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = 0.
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = 0.
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = 0.
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = 0.
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = 0.
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = 1.
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = -a31*dt
    dgd2c2term = -a32*dt
    dgd2n1term = -a33*dt
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]


def s3rads3rodex19(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad1c1 - ad1n - dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sin(2.0*a1c1)) + a12*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sin(2.0*a1c2)) + a13*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1)))

    da1c2term  = -dt*(a11*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cos(2.0*a1c1)) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c1term  = -a12*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cos(2.0*a1c2))
    da1n1term  = -a13*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cos(2.0*a1n1))
    db1c1term  = -dt*(a11*(1.0*gd1c1**2.0*sin(2.0*a1c1)*sin(b1c1)**1.0*cos(b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2.0*sin(2.0*a1c2)*sin(b1c2)**1.0*cos(b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a13*dt*(1.0*gd1n1**2.0*sin(2.0*a1n1)*sin(b1n1)**1.0*cos(b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a13*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a13*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a13*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a13*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 1.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = -1.0*a11*bd1c1**1.0*dt*sin(2.0*a1c1)
    dbd1c2term = -1.0*a12*bd1c2**1.0*dt*sin(2.0*a1c2)
    dbd1n1term = -1.0*a13*bd1n1**1.0*dt*sin(2.0*a1n1)
    dgd1c1term = -1.0*a11*dt*gd1c1**1.0*sin(2.0*a1c1)*sin(b1c1)**2.0
    dgd1c2term = -1.0*a12*dt*gd1c2**1.0*sin(2.0*a1c2)*sin(b1c2)**2.0
    dgd1n1term = -1.0*a13*dt*gd1n1**1.0*sin(2.0*a1n1)*sin(b1n1)**2.0
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a11*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a13*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex20(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad1c2 - ad1n - dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sin(2.0*a1c1)) + a22*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sin(2.0*a1c2)) + a23*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1)))

    da1c1term  = -dt*(a21*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cos(2.0*a1c1)) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cos(2.0*a1c2))
    da1n1term  = -a23*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cos(2.0*a1n1))
    db1c1term  = -dt*(a21*(1.0*gd1c1**2.0*sin(2.0*a1c1)*sin(b1c1)**1.0*cos(b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2.0*sin(2.0*a1c2)*sin(b1c2)**1.0*cos(b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a23*dt*(1.0*gd1n1**2.0*sin(2.0*a1n1)*sin(b1n1)**1.0*cos(b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a23*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a23*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a23*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a23*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 1.
    dad1n1term = 0.
    dbd1c1term = -1.0*a21*bd1c1**1.0*dt*sin(2.0*a1c1)
    dbd1c2term = -1.0*a22*bd1c2**1.0*dt*sin(2.0*a1c2)
    dbd1n1term = -1.0*a23*bd1n1**1.0*dt*sin(2.0*a1n1)
    dgd1c1term = -1.0*a21*dt*gd1c1**1.0*sin(2.0*a1c1)*sin(b1c1)**2.0
    dgd1c2term = -1.0*a22*dt*gd1c2**1.0*sin(2.0*a1c2)*sin(b1c2)**2.0
    dgd1n1term = -1.0*a23*dt*gd1n1**1.0*sin(2.0*a1n1)*sin(b1n1)**2.0
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a21*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a23*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex21(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -ad1n + ad1n1 - dt*(a31*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c1**2.0 + gd1c1**2.0*sin(b1c1)**2.0)*sin(2.0*a1c1)) + a32*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1c2**2.0 + gd1c2**2.0*sin(b1c2)**2.0)*sin(2.0*a1c2)) + a33*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1)))

    da1c1term  = -dt*(a31*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd1c1**2.0 + 0.5*gd1c1**2.0*sin(b1c1)**2.0)*cos(2.0*a1c1)) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1c2**2.0 + 0.5*gd1c2**2.0*sin(b1c2)**2.0)*cos(2.0*a1c2))
    da1n1term  = -a33*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cos(2.0*a1n1))
    db1c1term  = -dt*(a31*(1.0*gd1c1**2.0*sin(2.0*a1c1)*sin(b1c1)**1.0*cos(b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*(1.0*gd1c2**2.0*sin(2.0*a1c2)*sin(b1c2)**1.0*cos(b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a33*dt*(1.0*gd1n1**2.0*sin(2.0*a1n1)*sin(b1n1)**1.0*cos(b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a31*(-lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a32*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a33*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a32*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a33*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a31*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a32*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a33*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a31*(lamc1*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a32*dt*lamc2*sin(a2c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a33*dt*lamn1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 1.
    dbd1c1term = -1.0*a31*bd1c1**1.0*dt*sin(2.0*a1c1)
    dbd1c2term = -1.0*a32*bd1c2**1.0*dt*sin(2.0*a1c2)
    dbd1n1term = -1.0*a33*bd1n1**1.0*dt*sin(2.0*a1n1)
    dgd1c1term = -1.0*a31*dt*gd1c1**1.0*sin(2.0*a1c1)*sin(b1c1)**2.0
    dgd1c2term = -1.0*a32*dt*gd1c2**1.0*sin(2.0*a1c2)*sin(b1c2)**2.0
    dgd1n1term = -1.0*a33*dt*gd1n1**1.0*sin(2.0*a1n1)*sin(b1n1)**2.0
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a31*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - sin(a1c1)*cos(a2c1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a32*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a2c2)*cos(a1c2) - sin(a1c2)*cos(a2c2))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a33*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex22(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd1c1 - bd1n - dt*(a11*(-2.0*ad1c1*bd1c1/tan(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad1c2*bd1c2/tan(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a13*(-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a11*(-2.0*ad1c1*bd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-2.0)*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*bd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 - 1.0*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-2.0)*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a13*dt*(-2.0*ad1n1*bd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-2.0)*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a11*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))**2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a13*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a13*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a13*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a11*bd1c1*dt/tan(a1c1)
    dad1c2term = 2.0*a12*bd1c2*dt/tan(a1c2)
    dad1n1term = 2.0*a13*bd1n1*dt/tan(a1n1)
    dbd1c1term = 2.0*a11*ad1c1*dt/tan(a1c1) + 1
    dbd1c2term = 2.0*a12*ad1c2*dt/tan(a1c2)
    dbd1n1term = 2.0*a13*ad1n1*dt/tan(a1n1)
    dgd1c1term = -1.0*a11*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a12*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a13*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a11*dt*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a13*dt*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex23(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd1c2 - bd1n - dt*(a21*(-2.0*ad1c1*bd1c1/tan(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad1c2*bd1c2/tan(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a23*(-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a21*(-2.0*ad1c1*bd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-2.0)*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*bd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 - 1.0*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-2.0)*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a23*dt*(-2.0*ad1n1*bd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-2.0)*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a21*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))**2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a23*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a23*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a23*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a21*bd1c1*dt/tan(a1c1)
    dad1c2term = 2.0*a22*bd1c2*dt/tan(a1c2)
    dad1n1term = 2.0*a23*bd1n1*dt/tan(a1n1)
    dbd1c1term = 2.0*a21*ad1c1*dt/tan(a1c1)
    dbd1c2term = 2.0*a22*ad1c2*dt/tan(a1c2) + 1
    dbd1n1term = 2.0*a23*ad1n1*dt/tan(a1n1)
    dgd1c1term = -1.0*a21*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a22*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a23*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a21*dt*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a23*dt*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex24(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -bd1n + bd1n1 - dt*(a31*(-2.0*ad1c1*bd1c1/tan(a1c1) + 0.5*gd1c1**2*sin(2.0*b1c1) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a32*(-2.0*ad1c2*bd1c2/tan(a1c2) + 0.5*gd1c2**2*sin(2.0*b1c2) + lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a33*(-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a31*(-2.0*ad1c1*bd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-2.0)*sin(a2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*(-2.0*ad1c2*bd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 - 1.0*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-2.0)*sin(a2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a33*dt*(-2.0*ad1n1*bd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-2.0)*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a31*(1.0*gd1c1**2*cos(2.0*b1c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))**2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*(1.0*gd1c2**2*cos(2.0*b1c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a33*dt*(1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a31*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a32*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = -a33*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a31*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a32*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = -a33*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a31*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a31*bd1c1*dt/tan(a1c1)
    dad1c2term = 2.0*a32*bd1c2*dt/tan(a1c2)
    dad1n1term = 2.0*a33*bd1n1*dt/tan(a1n1)
    dbd1c1term = 2.0*a31*ad1c1*dt/tan(a1c1)
    dbd1c2term = 2.0*a32*ad1c2*dt/tan(a1c2)
    dbd1n1term = 2.0*a33*ad1n1*dt/tan(a1n1) + 1
    dgd1c1term = -1.0*a31*dt*gd1c1*sin(2.0*b1c1)
    dgd1c2term = -1.0*a32*dt*gd1c2*sin(2.0*b1c2)
    dgd1n1term = -1.0*a33*dt*gd1n1*sin(2.0*b1n1)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = -a31*dt*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)**(-1.0)*sin(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a32*dt*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)**(-1.0)*sin(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a33*dt*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex25(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad1c1*gd1c1/tan(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad1c2*gd1c2/tan(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a13*(-2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd1c1 - gd1n

    da1c1term  = -dt*(a11*(-2.0*ad1c1*gd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 + 1.0*lamc1*sin(a1c1)**(-2.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*(-2.0*ad1c2*gd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 + 1.0*lamc2*sin(a1c2)**(-2.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a13*dt*(-2.0*ad1n1*gd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 + 1.0*lamn1*sin(a1n1)**(-2.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a11*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + 1.0*lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + 1.0*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a13*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + 1.0*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a11*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a13*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a11*dt*gd1c1/tan(a1c1)
    dad1c2term = 2.0*a12*dt*gd1c2/tan(a1c2)
    dad1n1term = 2.0*a13*dt*gd1n1/tan(a1n1)
    dbd1c1term = 2.0*a11*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a12*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a13*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a11*dt*(-2.0*ad1c1/tan(a1c1) - 2.0*bd1c1/tan(b1c1)) + 1
    dgd1c2term = -a12*dt*(-2.0*ad1c2/tan(a1c2) - 2.0*bd1c2/tan(b1c2))
    dgd1n1term = -a13*dt*(-2.0*ad1n1/tan(a1n1) - 2.0*bd1n1/tan(b1n1))
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a11*dt*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = a12*dt*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = a13*dt*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex26(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad1c1*gd1c1/tan(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad1c2*gd1c2/tan(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a23*(-2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd1c2 - gd1n

    da1c1term  = -dt*(a21*(-2.0*ad1c1*gd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 + 1.0*lamc1*sin(a1c1)**(-2.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*(-2.0*ad1c2*gd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 + 1.0*lamc2*sin(a1c2)**(-2.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a23*dt*(-2.0*ad1n1*gd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 + 1.0*lamn1*sin(a1n1)**(-2.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a21*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + 1.0*lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + 1.0*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a23*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + 1.0*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a21*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a23*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a21*dt*gd1c1/tan(a1c1)
    dad1c2term = 2.0*a22*dt*gd1c2/tan(a1c2)
    dad1n1term = 2.0*a23*dt*gd1n1/tan(a1n1)
    dbd1c1term = 2.0*a21*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a22*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a23*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a21*dt*(-2.0*ad1c1/tan(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a22*dt*(-2.0*ad1c2/tan(a1c2) - 2.0*bd1c2/tan(b1c2)) + 1
    dgd1n1term = -a23*dt*(-2.0*ad1n1/tan(a1n1) - 2.0*bd1n1/tan(b1n1))
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a21*dt*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = a22*dt*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = a23*dt*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex27(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*(-2.0*ad1c1*gd1c1/tan(a1c1) - 2.0*bd1c1*gd1c1/tan(b1c1) - lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a32*(-2.0*ad1c2*gd1c2/tan(a1c2) - 2.0*bd1c2*gd1c2/tan(b1c2) - lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a33*(-2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*bd1n1*gd1n1/tan(b1n1) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) - gd1n + gd1n1

    da1c1term  = -dt*(a31*(-2.0*ad1c1*gd1c1*(-tan(a1c1)**2 - 1)/tan(a1c1)**2 + 1.0*lamc1*sin(a1c1)**(-2.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*(-2.0*ad1c2*gd1c2*(-tan(a1c2)**2 - 1)/tan(a1c2)**2 + 1.0*lamc2*sin(a1c2)**(-2.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da1n1term  = -a33*dt*(-2.0*ad1n1*gd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 + 1.0*lamn1*sin(a1n1)**(-2.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1c1term  = -dt*(a31*(-2.0*bd1c1*gd1c1*(-tan(b1c1)**2 - 1)/tan(b1c1)**2 + 1.0*lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-2.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b1c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*(-2.0*bd1c2*gd1c2*(-tan(b1c2)**2 - 1)/tan(b1c2)**2 + 1.0*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-2.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(b1c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db1n1term  = -a33*dt*(-2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + 1.0*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg1c1term  = -dt*(a31*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(-lamc1*sin(a1c1)**(-1.0)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2n1term  = a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2c1term  = -dt*(a31*(-lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**2*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db2n1term  = a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2c1term  = -dt*(a31*(lamc1*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*cos(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a2c1)**2*sin(b2c1)**2*sin(g1c1 - g2c1)**2/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)**(-1.0)*sin(a2c1)*sin(a2c2)*sin(b1c1)*sin(b1c2)**(-1.0)*sin(b2c1)*sin(b2c2)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a32*dt*lamc2*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*cos(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a33*dt*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 2.0*a31*dt*gd1c1/tan(a1c1)
    dad1c2term = 2.0*a32*dt*gd1c2/tan(a1c2)
    dad1n1term = 2.0*a33*dt*gd1n1/tan(a1n1)
    dbd1c1term = 2.0*a31*dt*gd1c1/tan(b1c1)
    dbd1c2term = 2.0*a32*dt*gd1c2/tan(b1c2)
    dbd1n1term = 2.0*a33*dt*gd1n1/tan(b1n1)
    dgd1c1term = -a31*dt*(-2.0*ad1c1/tan(a1c1) - 2.0*bd1c1/tan(b1c1))
    dgd1c2term = -a32*dt*(-2.0*ad1c2/tan(a1c2) - 2.0*bd1c2/tan(b1c2))
    dgd1n1term = -a33*dt*(-2.0*ad1n1/tan(a1n1) - 2.0*bd1n1/tan(b1n1)) + 1
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = a31*dt*sin(a1c1)**(-1.0)*sin(a2c1)*sin(b1c1)**(-1.0)*sin(b2c1)*sin(g1c1 - g2c1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = a32*dt*sin(a1c2)**(-1.0)*sin(a2c2)*sin(b1c2)**(-1.0)*sin(b2c2)*sin(g1c2 - g2c2)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = a33*dt*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex28(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad2c1 - ad2n - dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sin(2.0*a2c1)) + a12*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sin(2.0*a2c2)) + a13*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1)))

    da1c1term  = -dt*(a11*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a13*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a13*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a13*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cos(2.0*a2c1)) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cos(2.0*a2c2))
    da2n1term  = -a13*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cos(2.0*a2n1))
    db2c1term  = -dt*(a11*(1.0*gd2c1**2.0*sin(2.0*a2c1)*sin(b2c1)**1.0*cos(b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2.0*sin(2.0*a2c2)*sin(b2c2)**1.0*cos(b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a13*dt*(1.0*gd2n1**2.0*sin(2.0*a2n1)*sin(b2n1)**1.0*cos(b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a13*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 1.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = -1.0*a11*bd2c1**1.0*dt*sin(2.0*a2c1)
    dbd2c2term = -1.0*a12*bd2c2**1.0*dt*sin(2.0*a2c2)
    dbd2n1term = -1.0*a13*bd2n1**1.0*dt*sin(2.0*a2n1)
    dgd2c1term = -1.0*a11*dt*gd2c1**1.0*sin(2.0*a2c1)*sin(b2c1)**2.0
    dgd2c2term = -1.0*a12*dt*gd2c2**1.0*sin(2.0*a2c2)*sin(b2c2)**2.0
    dgd2n1term = -1.0*a13*dt*gd2n1**1.0*sin(2.0*a2n1)*sin(b2n1)**2.0
    dlamc1term = -a11*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a13*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex29(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = ad2c2 - ad2n - dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sin(2.0*a2c1)) + a22*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sin(2.0*a2c2)) + a23*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1)))

    da1c1term  = -dt*(a21*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a23*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a23*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a23*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cos(2.0*a2c1)) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cos(2.0*a2c2))
    da2n1term  = -a23*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cos(2.0*a2n1))
    db2c1term  = -dt*(a21*(1.0*gd2c1**2.0*sin(2.0*a2c1)*sin(b2c1)**1.0*cos(b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2.0*sin(2.0*a2c2)*sin(b2c2)**1.0*cos(b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a23*dt*(1.0*gd2n1**2.0*sin(2.0*a2n1)*sin(b2n1)**1.0*cos(b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a23*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 1.
    dad2n1term = 0.
    dbd2c1term = -1.0*a21*bd2c1**1.0*dt*sin(2.0*a2c1)
    dbd2c2term = -1.0*a22*bd2c2**1.0*dt*sin(2.0*a2c2)
    dbd2n1term = -1.0*a23*bd2n1**1.0*dt*sin(2.0*a2n1)
    dgd2c1term = -1.0*a21*dt*gd2c1**1.0*sin(2.0*a2c1)*sin(b2c1)**2.0
    dgd2c2term = -1.0*a22*dt*gd2c2**1.0*sin(2.0*a2c2)*sin(b2c2)**2.0
    dgd2n1term = -1.0*a23*dt*gd2n1**1.0*sin(2.0*a2n1)*sin(b2n1)**2.0
    dlamc1term = -a21*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a23*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex30(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -ad2n + ad2n1 - dt*(a31*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c1**2.0 + gd2c1**2.0*sin(b2c1)**2.0)*sin(2.0*a2c1)) + a32*(lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2c2**2.0 + gd2c2**2.0*sin(b2c2)**2.0)*sin(2.0*a2c2)) + a33*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1)))

    da1c1term  = -dt*(a31*(lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*cos(a1c1)*cos(a2c1) + sin(a1c1)*sin(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*lamc2*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*cos(a1c2)*cos(a2c2) + sin(a1c2)*sin(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a33*dt*lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a31*(lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*lamc2*(-sin(b1c2)*cos(b2c2) + sin(b2c2)*cos(b1c2)*cos(g1c2 - g2c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a33*dt*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a31*(-lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a32*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a33*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(lamc1*(-(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) - cos(a1c1)*cos(a2c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 2.0*(0.5*bd2c1**2.0 + 0.5*gd2c1**2.0*sin(b2c1)**2.0)*cos(2.0*a2c1)) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a32*dt*(lamc2*(-(sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2) - cos(a1c2)*cos(a2c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2c2**2.0 + 0.5*gd2c2**2.0*sin(b2c2)**2.0)*cos(2.0*a2c2))
    da2n1term  = -a33*dt*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cos(2.0*a2n1))
    db2c1term  = -dt*(a31*(1.0*gd2c1**2.0*sin(2.0*a2c1)*sin(b2c1)**1.0*cos(b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a32*dt*(1.0*gd2c2**2.0*sin(2.0*a2c2)*sin(b2c2)**1.0*cos(b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a33*dt*(1.0*gd2n1**2.0*sin(2.0*a2n1)*sin(b2n1)**1.0*cos(b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a31*(lamc1*sin(a1c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a32*dt*lamc2*sin(a1c2)*sin(b1c2)*sin(b2c2)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a33*dt*lamn1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 1.
    dbd2c1term = -1.0*a31*bd2c1**1.0*dt*sin(2.0*a2c1)
    dbd2c2term = -1.0*a32*bd2c2**1.0*dt*sin(2.0*a2c2)
    dbd2n1term = -1.0*a33*bd2n1**1.0*dt*sin(2.0*a2n1)
    dgd2c1term = -1.0*a31*dt*gd2c1**1.0*sin(2.0*a2c1)*sin(b2c1)**2.0
    dgd2c2term = -1.0*a32*dt*gd2c2**1.0*sin(2.0*a2c2)*sin(b2c2)**2.0
    dgd2n1term = -1.0*a33*dt*gd2n1**1.0*sin(2.0*a2n1)*sin(b2n1)**2.0
    dlamc1term = -a31*dt*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - sin(a2c1)*cos(a1c1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a32*dt*((sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) + cos(b1c2)*cos(b2c2))*sin(a1c2)*cos(a2c2) - sin(a2c2)*cos(a1c2))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a33*dt*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex31(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd2c1 - bd2n - dt*(a11*(-2.0*ad2c1*bd2c1/tan(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad2c2*bd2c2/tan(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a13*(-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a11*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**(-1.0)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)**(-1.0)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a13*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**(-1.0)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a13*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a13*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-2.0*ad2c1*bd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-2.0)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*bd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-2.0)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a13*dt*(-2.0*ad2n1*bd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-2.0)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a11*(1.0*gd2c1**2*cos(2.0*b2c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))**2*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(1.0*gd2c2**2*cos(2.0*b2c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a13*dt*(1.0*gd2n1**2*cos(2.0*b2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a13*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a11*bd2c1*dt/tan(a2c1)
    dad2c2term = 2.0*a12*bd2c2*dt/tan(a2c2)
    dad2n1term = 2.0*a13*bd2n1*dt/tan(a2n1)
    dbd2c1term = 2.0*a11*ad2c1*dt/tan(a2c1) + 1
    dbd2c2term = 2.0*a12*ad2c2*dt/tan(a2c2)
    dbd2n1term = 2.0*a13*ad2n1*dt/tan(a2n1)
    dgd2c1term = -1.0*a11*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a12*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a13*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = -a11*dt*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a13*dt*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex32(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = bd2c2 - bd2n - dt*(a21*(-2.0*ad2c1*bd2c1/tan(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad2c2*bd2c2/tan(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a23*(-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a21*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**(-1.0)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)**(-1.0)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a23*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**(-1.0)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a23*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a23*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-2.0*ad2c1*bd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-2.0)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*bd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-2.0)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a23*dt*(-2.0*ad2n1*bd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-2.0)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a21*(1.0*gd2c1**2*cos(2.0*b2c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))**2*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(1.0*gd2c2**2*cos(2.0*b2c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a23*dt*(1.0*gd2n1**2*cos(2.0*b2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a23*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a21*bd2c1*dt/tan(a2c1)
    dad2c2term = 2.0*a22*bd2c2*dt/tan(a2c2)
    dad2n1term = 2.0*a23*bd2n1*dt/tan(a2n1)
    dbd2c1term = 2.0*a21*ad2c1*dt/tan(a2c1)
    dbd2c2term = 2.0*a22*ad2c2*dt/tan(a2c2) + 1
    dbd2n1term = 2.0*a23*ad2n1*dt/tan(a2n1)
    dgd2c1term = -1.0*a21*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a22*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a23*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = -a21*dt*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a23*dt*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex33(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -bd2n + bd2n1 - dt*(a31*(-2.0*ad2c1*bd2c1/tan(a2c1) + 0.5*gd2c1**2*sin(2.0*b2c1) + lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a32*(-2.0*ad2c2*bd2c2/tan(a2c2) + 0.5*gd2c2**2*sin(2.0*b2c2) + lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a33*(-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))))

    da1c1term  = -dt*(a31*(lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a2c1)**(-1.0)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a2c2)**(-1.0)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a33*dt*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**(-1.0)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a31*(lamc1*(sin(b1c1)*sin(b2c1) + cos(b1c1)*cos(b2c1)*cos(g1c1 - g2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*lamc2*(sin(b1c2)*sin(b2c2) + cos(b1c2)*cos(b2c2)*cos(g1c2 - g2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a33*dt*lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a31*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = a32*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = a33*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(-2.0*ad2c1*bd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-2.0)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a32*dt*(-2.0*ad2c2*bd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-2.0)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a33*dt*(-2.0*ad2n1*bd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-2.0)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a31*(1.0*gd2c1**2*cos(2.0*b2c1) + lamc1*(-sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) - cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))**2*sin(a1c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a32*dt*(1.0*gd2c2**2*cos(2.0*b2c2) + lamc2*(-sin(b1c2)*sin(b2c2)*cos(g1c2 - g2c2) - cos(b1c2)*cos(b2c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a33*dt*(1.0*gd2n1**2*cos(2.0*b2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a31*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = -a32*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = -a33*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a31*bd2c1*dt/tan(a2c1)
    dad2c2term = 2.0*a32*bd2c2*dt/tan(a2c2)
    dad2n1term = 2.0*a33*bd2n1*dt/tan(a2n1)
    dbd2c1term = 2.0*a31*ad2c1*dt/tan(a2c1)
    dbd2c2term = 2.0*a32*ad2c2*dt/tan(a2c2)
    dbd2n1term = 2.0*a33*ad2n1*dt/tan(a2n1) + 1
    dgd2c1term = -1.0*a31*dt*gd2c1*sin(2.0*b2c1)
    dgd2c2term = -1.0*a32*dt*gd2c2*sin(2.0*b2c2)
    dgd2n1term = -1.0*a33*dt*gd2n1*sin(2.0*b2n1)
    dlamc1term = -a31*dt*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a32*dt*(sin(b1c2)*cos(b2c2)*cos(g1c2 - g2c2) - sin(b2c2)*cos(b1c2))*sin(a1c2)*sin(a2c2)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a33*dt*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex34(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a11*(-2.0*ad2c1*gd2c1/tan(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a12*(-2.0*ad2c2*gd2c2/tan(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a13*(-2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd2c1 - gd2n

    da1c1term  = -dt*(a11*(lamc1*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a12*dt*lamc2*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a13*dt*lamn1*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a13*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a11*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = -a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = -a13*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a11*(-2.0*ad2c1*gd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-2.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a12*dt*(-2.0*ad2c2*gd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-2.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a13*dt*(-2.0*ad2n1*gd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-2.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a11*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a12*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a13*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a11*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a12*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a13*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = a12*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = a13*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a11*dt*gd2c1/tan(a2c1)
    dad2c2term = 2.0*a12*dt*gd2c2/tan(a2c2)
    dad2n1term = 2.0*a13*dt*gd2n1/tan(a2n1)
    dbd2c1term = 2.0*a11*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a12*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a13*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a11*dt*(-2.0*ad2c1/tan(a2c1) - 2.0*bd2c1/tan(b2c1)) + 1
    dgd2c2term = -a12*dt*(-2.0*ad2c2/tan(a2c2) - 2.0*bd2c2/tan(b2c2))
    dgd2n1term = -a13*dt*(-2.0*ad2n1/tan(a2n1) - 2.0*bd2n1/tan(b2n1))
    dlamc1term = -a11*dt*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a12*dt*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a13*dt*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex35(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a21*(-2.0*ad2c1*gd2c1/tan(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a22*(-2.0*ad2c2*gd2c2/tan(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a23*(-2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) + gd2c2 - gd2n

    da1c1term  = -dt*(a21*(lamc1*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a22*dt*lamc2*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a23*dt*lamn1*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a23*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a21*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = -a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = -a23*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a21*(-2.0*ad2c1*gd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-2.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a22*dt*(-2.0*ad2c2*gd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-2.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a23*dt*(-2.0*ad2n1*gd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-2.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a21*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a22*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a23*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a21*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a22*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a23*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = a22*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = a23*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a21*dt*gd2c1/tan(a2c1)
    dad2c2term = 2.0*a22*dt*gd2c2/tan(a2c2)
    dad2n1term = 2.0*a23*dt*gd2n1/tan(a2n1)
    dbd2c1term = 2.0*a21*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a22*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a23*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a21*dt*(-2.0*ad2c1/tan(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a22*dt*(-2.0*ad2c2/tan(a2c2) - 2.0*bd2c2/tan(b2c2)) + 1
    dgd2n1term = -a23*dt*(-2.0*ad2n1/tan(a2n1) - 2.0*bd2n1/tan(b2n1))
    dlamc1term = -a21*dt*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a22*dt*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a23*dt*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex36(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -dt*(a31*(-2.0*ad2c1*gd2c1/tan(a2c1) - 2.0*bd2c1*gd2c1/tan(b2c1) + lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a32*(-2.0*ad2c2*gd2c2/tan(a2c2) - 2.0*bd2c2*gd2c2/tan(b2c2) + lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))) + a33*(-2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))) - gd2n + gd2n1

    da1c1term  = -dt*(a31*(lamc1*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da1c2term  = -a32*dt*lamc2*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da1n1term  = -a33*dt*lamn1*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1c1term  = -dt*(a31*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(b1c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db1c2term  = -a32*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(b1c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    db1n1term  = -a33*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1c1term  = -dt*(a31*(lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) - 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg1c2term  = -a32*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg1n1term  = -a33*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    da2c1term  = -dt*(a31*(-2.0*ad2c1*gd2c1*(-tan(a2c1)**2 - 1)/tan(a2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-2.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)*cos(a2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    da2c2term  = -a32*dt*(-2.0*ad2c2*gd2c2*(-tan(a2c2)**2 - 1)/tan(a2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-2.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)*cos(a2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    da2n1term  = -a33*dt*(-2.0*ad2n1*gd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-2.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2c1term  = -dt*(a31*(-2.0*bd2c1*gd2c1*(-tan(b2c1)**2 - 1)/tan(b2c1)**2 - 1.0*lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-2.0)*sin(g1c1 - g2c1)*cos(b2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)**2*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    db2c2term  = -a32*dt*(-2.0*bd2c2*gd2c2*(-tan(b2c2)**2 - 1)/tan(b2c2)**2 - 1.0*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-2.0)*sin(g1c2 - g2c2)*cos(b2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    db2n1term  = -a33*dt*(-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))
    dg2c1term  = -dt*(a31*(-lamc1*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*cos(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 1.0*lamc1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)**2*sin(b1c1)**2*sin(g1c1 - g2c1)**2/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2))) + 1.0*a32*lamc2*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1c2)*sin(a2c1)*sin(a2c2)**(-1.0)*sin(b1c1)*sin(b1c2)*sin(b2c1)*sin(b2c2)**(-1.0)*sin(g1c1 - g2c1)*sin(g1c2 - g2c2)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*a33*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))
    dg2c2term  = a32*dt*lamc2*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*cos(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dg2n1term  = a33*dt*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 2.0*a31*dt*gd2c1/tan(a2c1)
    dad2c2term = 2.0*a32*dt*gd2c2/tan(a2c2)
    dad2n1term = 2.0*a33*dt*gd2n1/tan(a2n1)
    dbd2c1term = 2.0*a31*dt*gd2c1/tan(b2c1)
    dbd2c2term = 2.0*a32*dt*gd2c2/tan(b2c2)
    dbd2n1term = 2.0*a33*dt*gd2n1/tan(b2n1)
    dgd2c1term = -a31*dt*(-2.0*ad2c1/tan(a2c1) - 2.0*bd2c1/tan(b2c1))
    dgd2c2term = -a32*dt*(-2.0*ad2c2/tan(a2c2) - 2.0*bd2c2/tan(b2c2))
    dgd2n1term = -a33*dt*(-2.0*ad2n1/tan(a2n1) - 2.0*bd2n1/tan(b2n1)) + 1
    dlamc1term = -a31*dt*sin(a1c1)*sin(a2c1)**(-1.0)*sin(b1c1)*sin(b2c1)**(-1.0)*sin(g1c1 - g2c1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamc2term = -a32*dt*sin(a1c2)*sin(a2c2)**(-1.0)*sin(b1c2)*sin(b2c2)**(-1.0)*sin(g1c2 - g2c2)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))
    dlamn1term = -a33*dt*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0))

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex37(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = -leq + arccos((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = -((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = -(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = -((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = -(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = -sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = 0.
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = 0.
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = 0.
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = 0.
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = 0.
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = 0.
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex38(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = (-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)

    da1c1term  = 0.
    da1c2term  = 0.
    da1n1term  = (ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1*cos(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - ad2n1*sin(a1n1)*sin(a2n1) + (bd1n1*sin(b1n1)*cos(b2n1) - bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + bd2n1*sin(b2n1)*cos(b1n1) + (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a2n1)*cos(a1n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - 2.0*sin(a1n1)*cos(a2n1))*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))/(2*(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2))
    db1c1term  = 0.
    db1c2term  = 0.
    db1n1term  = (-ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) - ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + (bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd1n1*cos(b1n1)*cos(b2n1) - bd2n1*sin(b1n1)*sin(b2n1) - bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n)*cos(b1n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dg1c1term  = 0.
    dg1c2term  = 0.
    dg1n1term  = (ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) + ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + (bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) - 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    da2c1term  = 0.
    da2c2term  = 0.
    da2n1term  = (-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - ad1n1*sin(a1n1)*sin(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1*cos(a1n1)*cos(a2n1) + (bd1n1*sin(b1n1)*cos(b2n1) - bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + bd2n1*sin(b2n1)*cos(b1n1) + (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*cos(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - 2.0*sin(a2n1)*cos(a1n1))*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))/(2*(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2))
    db2c1term  = 0.
    db2c2term  = 0.
    db2n1term  = (-ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1) - ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1) + (-bd1n1*sin(b1n1)*sin(b2n1) - bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd2n1*cos(b1n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n)*cos(b2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dg2c1term  = 0.
    dg2c2term  = 0.
    dg2n1term  = (-ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) - ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + (-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1*sin(a1n1)*cos(a2n1) - ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1*sin(a2n1)*cos(a1n1) - (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = ((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + sin(a1n1)*cos(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = ((-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + sin(a2n1)*cos(a1n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = -sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = 0.

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]

def s3rads3rodex39(stepn,stepc1,stepc2,stepn1,dt,params):
    root6 = sqrt(6.)
    # Set to run RadauIIA 3-stage method
    a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
    a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
    a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
    bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

    a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
    a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
    a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
    a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
    m1,m2,leq = params

    mainterm = (-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)

    da1c1term  = (lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a2n1)*cos(a1n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1n1)*cos(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (-lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a2c1)*cos(a1c1) - 2.0*sin(a1c1)*cos(a2c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    da1c2term  = 0.
    da1n1term  = (2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a2n1)*cos(a1n1) + 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1**2.0*sin(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*cos(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad2n1**2.0*sin(a1n1)*cos(a2n1) + lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))*sin(a2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cos(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*sin(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*cos(a1n1)*cos(a2n1) + (lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd1n1**2.0 + 0.5*gd1n1**2.0*sin(b1n1)**2.0)*cos(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*cos(a1n1)*cos(a2n1) - (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*sin(a2n1) + (-lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**(-1.0)*sin(b1n1)*cos(a1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**(-1.0)*sin(b2n1)*cos(a1n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - (-2.0*ad1n1*bd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-2.0)*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (2.0*ad1n1*bd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 + 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-2.0)*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) - (2.0*ad1n1*gd1n1*(-tan(a1n1)**2 - 1)/tan(a1n1)**2 + lamn1*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamn1*sin(a1n1)**(-2.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd1n1**2.0*cos(b1n1)*cos(b2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*cos(b1n1)*cos(b2n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) + (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(-2.0*ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*cos(a1n1)*cos(a2n1) + 2.0*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + 2.0*ad2n1*sin(a1n1)*sin(a2n1) + 2.0*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a2n1)*cos(a1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - 2.0*sin(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - 2.0*sin(a1n1)*cos(a2n1))*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/(2*(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2))
    db1c1term  = (1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*cos(a2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*cos(a1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*cos(a1n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*cos(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (-1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1c1)*cos(b2c1) + sin(b2c1)*cos(b1c1)*cos(g1c1 - g2c1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    db1c2term  = 0.
    db1n1term  = (-2.0*ad1n1*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1*cos(b1n1)*cos(b2n1) + bd2n1*sin(b1n1)*sin(b2n1) + bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1*cos(b1n1)*cos(b2n1) + bd2n1*sin(b1n1)*sin(b2n1) + bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**2*cos(a2n1)**2/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)*cos(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) + (sin(b1n1)*cos(b2n1) - sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(1.0*gd1n1**2.0*sin(2.0*a1n1)*sin(b1n1)**1.0*cos(b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(a2n1)*cos(a1n1) + (1.0*gd1n1**2.0*sin(2.0*a1n1)*sin(b1n1)**1.0*cos(b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(a1n1)*cos(a2n1) + (2.0*bd1n1*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*bd2n1*sin(b2n1)*cos(b1n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - bd1n1**2.0*sin(b1n1)*cos(b2n1) + bd1n1**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*cos(b2n1) + bd2n1**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (gd1n1 - gd2n1)**2.0*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-1.0*gd1n1**2*cos(2.0*b1n1) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) - (1.0*gd1n1**2*cos(2.0*b1n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad1n1*bd1n1/tan(a1n1) - 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*cos(b1n1)*cos(b2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (2.0*ad2n1*bd2n1/tan(a2n1) - 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1) - (2.0*bd1n1*gd1n1*(-tan(b1n1)**2 - 1)/tan(b1n1)**2 + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - 1.0*lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-2.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*ad2n1*gd2n1/tan(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1) + (-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(2.0*ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + 2.0*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + 2.0*(-bd1n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1*cos(b1n1)*cos(b2n1) + bd2n1*sin(b1n1)*sin(b2n1) + bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-gd1n1 + gd2n1)*sin(b2n1)*sin(g1n1 - g2n)*cos(b1n1))*sin(a1n1)*sin(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dg1c1term  = (-1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*cos(b1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (-1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dg1c2term  = 0.
    dg1n1term  = (2.0*ad1n1*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) - ad1n1**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - 2.0*ad2n1*(-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) - ad2n1**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**2*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)**2/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)**2*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)**2/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + (2.0*bd1n1*bd2n1*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)**2*sin(g1n1 - g2n1)*cos(b2n1)**2*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)**2*sin(g1n1 - g2n1)*cos(b1n1)**2*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*ad2n1*gd2n1/tan(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(-2.0*ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) - 2.0*ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + 2.0*(-bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n))*sin(a1n1)*sin(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) - (ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) - 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) - 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    da2c1term  = (lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a2n1)*cos(a1n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1n1)*cos(a2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (-lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(2*m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(2.0*(sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*cos(a2c1) - 2.0*sin(a2c1)*cos(a1c1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(2*m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    da2c2term  = 0.
    da2n1term  = (2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*cos(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*cos(a1n1)*cos(a2n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad1n1**2.0*sin(a2n1)*cos(a1n1) + 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1**2.0*sin(a2n1)*cos(a1n1) + lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + sin(a1n1)*sin(a2n1))*sin(a1n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*cos(a1n1)*cos(a2n1) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cos(2.0*a2n1))*sin(a1n1)*cos(a2n1) - (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*sin(a2n1) - (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*sin(a2n1) + (lamn1*(-(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - cos(a1n1)*cos(a2n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 2.0*(0.5*bd2n1**2.0 + 0.5*gd2n1**2.0*sin(b2n1)**2.0)*cos(2.0*a2n1))*sin(a2n1)*cos(a1n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*cos(a1n1)*cos(a2n1) + (lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(b1n1)*cos(a2n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(b2n1)*cos(a2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - (-2.0*ad2n1*bd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-2.0)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (2.0*ad2n1*bd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 + 1.0*lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-2.0)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad2n1*gd2n1*(-tan(a2n1)**2 - 1)/tan(a2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-2.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd1n1**2.0*cos(b1n1)*cos(b2n1) + 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*cos(b1n1)*cos(b2n1) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) + (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0*(2.0*ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) + 2.0*ad1n1*sin(a1n1)*sin(a2n1) - 2.0*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) - 2.0*ad2n1*cos(a1n1)*cos(a2n1) + 2.0*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*cos(a2n1))/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - 2.0*sin(a2n1)*cos(a1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - 2.0*sin(a2n1)*cos(a1n1))*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/(2*(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2))
    db2c1term  = (1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*cos(a2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*cos(a1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*cos(a1n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*cos(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (-1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1c1)*cos(b2c1)*cos(g1c1 - g2c1) - sin(b2c1)*cos(b1c1))*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    db2c2term  = 0.
    db2n1term  = (-2.0*ad1n1*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*(bd1n1*sin(b1n1)*sin(b2n1) + bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1*cos(b1n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1) - 2.0*ad2n1*(bd1n1*sin(b1n1)*sin(b2n1) + bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1*cos(b1n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)**2*cos(a1n1)**2/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)*cos(a1n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*(1.0*gd2n1**2.0*sin(2.0*a2n1)*sin(b2n1)**1.0*cos(b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(a1n1)*cos(a2n1) + (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) + (-sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + sin(b2n1)*cos(b1n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (1.0*gd2n1**2.0*sin(2.0*a2n1)*sin(b2n1)**1.0*cos(b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(a2n1)*cos(a1n1) + (-2.0*bd1n1*bd2n1*sin(b1n1)*cos(b2n1) + 2.0*bd1n1*bd2n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*bd1n1*(gd1n1 - gd2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) + bd1n1**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*sin(b2n1)*cos(b1n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + bd2n1**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*sin(b2n1)*cos(b1n1) + lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*(sin(b1n1)*sin(b2n1) + cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-1.0*gd2n1**2*cos(2.0*b2n1) - lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (1.0*gd2n1**2*cos(2.0*b2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + (2.0*ad1n1*bd1n1/tan(a1n1) - 0.5*gd1n1**2*sin(2.0*b1n1) - lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad2n1*bd2n1/tan(a2n1) - 0.5*gd2n1**2*sin(2.0*b2n1) - lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*cos(b1n1)*cos(b2n1) - (-2.0*bd2n1*gd2n1*(-tan(b2n1)**2 - 1)/tan(b2n1)**2 - 1.0*lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-2.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(g1n1 - g2n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*ad2n1*gd2n1/tan(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(2.0*ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1) + 2.0*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1) + 2.0*(bd1n1*sin(b1n1)*sin(b2n1) + bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1*cos(b1n1)*cos(b2n1) + (-gd1n1 + gd2n1)*sin(b1n1)*sin(g1n1 - g2n)*cos(b2n1))*sin(a1n1)*sin(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + (sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dg2c1term  = (1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1c1)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a1n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(b1c1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(a2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + (-1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*cos(b1n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(g1c1 - g2c1)*cos(b2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - 1.0*lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) - (1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)*sin(a2c1)*sin(a2n1)**(-1.0)*sin(b1c1)*sin(b1n1)*sin(b2c1)*sin(b2n1)**(-1.0)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m2*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)) + 1.0*lamn1*((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**1.0*sin(a1c1)*sin(a1n1)**(-1.0)*sin(a2c1)*sin(a2n1)*sin(b1c1)*sin(b1n1)**(-1.0)*sin(b2c1)*sin(b2n1)*sin(g1c1 - g2c1)*sin(g1n1 - g2n1)/(m1*(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)**(3/2)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dg2c2term  = 0.
    dg2n1term  = (-2.0*ad1n1*ad2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*(bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - 2.0*ad2n1*(bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - (-gd1n1 + gd2n1)*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)**2*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1)**2/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)**2*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)**2/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) - (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + (-2.0*bd1n1*bd2n1*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd1n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + bd2n1**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)**2*sin(g1n1 - g2n1)*cos(b2n1)**2*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)**2*sin(g1n1 - g2n1)*cos(b1n1)**2*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (-lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + (2.0*ad1n1*gd1n1/tan(a1n1) - 2.0*ad2n1*gd2n1/tan(a2n1) + 2.0*bd1n1*gd1n1/tan(b1n1) - 2.0*bd2n1*gd2n1/tan(b2n1) + lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(2.0*ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) + 2.0*ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + 2.0*(bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a1n1)*sin(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + (ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**2)/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0) + 1.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**1.0*(-2.0*ad1n1*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*ad2n1*sin(a1n1)*sin(a2n1) - 2.0*ad1n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ad1n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad1n1**2.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ad2n1**2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + ad2n1**2.0*cos(a1n1)*cos(a2n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a2n1)*cos(a1n1) - (sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*(lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd1n1**2.0 + gd1n1**2.0*sin(b1n1)**2.0)*sin(2.0*a1n1))*sin(a1n1)*cos(a2n1) + (lamn1*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + 0.5*(bd2n1**2.0 + gd2n1**2.0*sin(b2n1)**2.0)*sin(2.0*a2n1))*sin(a2n1)*cos(a1n1) - (2.0*bd1n1*bd2n1*sin(b1n1)*sin(b2n1) + 2.0*bd1n1*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*bd1n1*(gd1n1 - gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - bd1n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd1n1**2.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*(gd1n1 - gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - bd2n1**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - bd2n1**2.0*cos(b1n1)*cos(b2n1) - (gd1n1 - gd2n1)**2.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1) + (-2.0*ad1n1*bd1n1/tan(a1n1) + 0.5*gd1n1**2*sin(2.0*b1n1) + lamn1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1*bd2n1/tan(a2n1) + 0.5*gd2n1**2*sin(2.0*b2n1) + lamn1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b2n1)*cos(b1n1) - (-2.0*ad1n1*gd1n1/tan(a1n1) + 2.0*ad2n1*gd2n1/tan(a2n1) - 2.0*bd1n1*gd1n1/tan(b1n1) + 2.0*bd2n1*gd2n1/tan(b2n1) - lamn1*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - lamn1*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**2.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)**(3/2)
    dad1c1term = 0.
    dad1c2term = 0.
    dad1n1term = (2.0*ad1n1**1.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + 2.0*ad1n1**1.0*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad2n1*sin(a1n1)*sin(a2n1) + (-2.0*bd1n1*sin(b1n1)*cos(b2n1)/tan(a1n1) + 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/tan(a1n1) - 2.0*gd1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(a1n1))*sin(a1n1)*sin(a2n1) + (2.0*bd1n1*sin(b1n1)*cos(b2n1) - 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - 2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*sin(b2n1)*cos(b1n1) + 2.0*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - 2.0*sin(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dbd1c1term = 0.
    dbd1c2term = 0.
    dbd1n1term = (-2.0*ad1n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a2n1)*cos(a1n1) - 2.0*ad2n1*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + 1.0*bd1n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(2.0*a1n1)*sin(a2n1)*cos(a1n1) + 1.0*bd1n1**1.0*sin(a1n1)*sin(2.0*a1n1)*cos(a2n1) + (-2.0*ad1n1*sin(b1n1)*cos(b2n1)/tan(a1n1) + 2.0*ad1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/tan(a1n1) + 2.0*bd1n1**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + 2.0*bd1n1**1.0*cos(b1n1)*cos(b2n1) - 2.0*bd2n1*sin(b1n1)*sin(b2n1) - 2.0*bd2n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - 2.0*gd1n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(b1n1) - (-2.0*gd1n1 + 2.0*gd2n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1) + 2.0*(-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dgd1c1term = 0.
    dgd1c2term = 0.
    dgd1n1term = (2.0*ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) + 2.0*ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + 1.0*gd1n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(2.0*a1n1)*sin(a2n1)*sin(b1n1)**2.0*cos(a1n1) + 1.0*gd1n1**1.0*sin(a1n1)*sin(2.0*a1n1)*sin(b1n1)**2.0*cos(a2n1) + (2.0*bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) + 2.0*bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) + 1.0*gd1n1*sin(b1n1)*sin(2.0*b1n1)*cos(b2n1) - 1.0*gd1n1*sin(2.0*b1n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + 2.0*(gd1n1 - gd2n1)**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (2.0*ad1n1/tan(a1n1) + 2.0*bd1n1/tan(b1n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) - 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dad2c1term = 0.
    dad2c2term = 0.
    dad2n1term = (-2.0*ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*cos(a1n1)*cos(a2n1) - 2.0*ad1n1*sin(a1n1)*sin(a2n1) + 2.0*ad2n1**1.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + 2.0*ad2n1**1.0*cos(a1n1)*cos(a2n1) + (2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/tan(a2n1) - 2.0*bd2n1*sin(b2n1)*cos(b1n1)/tan(a2n1) + 2.0*gd2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(a2n1))*sin(a1n1)*sin(a2n1) + (2.0*bd1n1*sin(b1n1)*cos(b2n1) - 2.0*bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) - 2.0*bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1*sin(b2n1)*cos(b1n1) + 2.0*(gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*cos(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(2.0*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - 2.0*sin(a2n1)*cos(a1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dbd2c1term = 0.
    dbd2c2term = 0.
    dbd2n1term = (-2.0*ad1n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a2n1)*cos(a1n1) - 2.0*ad2n1*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*cos(a2n1) + 1.0*bd2n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(2.0*a2n1)*cos(a2n1) + 1.0*bd2n1**1.0*sin(a2n1)*sin(2.0*a2n1)*cos(a1n1) + (2.0*ad2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/tan(a2n1) - 2.0*ad2n1*sin(b2n1)*cos(b1n1)/tan(a2n1) - 2.0*bd1n1*sin(b1n1)*sin(b2n1) - 2.0*bd1n1*cos(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + 2.0*bd2n1**1.0*cos(b1n1)*cos(b2n1) + 2.0*gd2n1*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)/tan(b2n1) - (-2.0*gd1n1 + 2.0*gd2n1)*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0*sin(a1n1)*sin(a2n1)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dgd2c1term = 0.
    dgd2c2term = 0.
    dgd2n1term = (-2.0*ad1n1*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a1n1) - 2.0*ad2n1*sin(a1n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1)*cos(a2n1) + 1.0*gd2n1**1.0*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(2.0*a2n1)*sin(b2n1)**2.0*cos(a2n1) + 1.0*gd2n1**1.0*sin(a2n1)*sin(2.0*a2n1)*sin(b2n1)**2.0*cos(a1n1) + (-2.0*bd1n1*sin(b2n1)*sin(g1n1 - g2n1)*cos(b1n1) - 2.0*bd2n1*sin(b1n1)*sin(g1n1 - g2n1)*cos(b2n1) - 1.0*gd2n1*sin(b1n1)*sin(2.0*b2n1)*cos(b2n1)*cos(g1n1 - g2n1) + 1.0*gd2n1*sin(b2n1)*sin(2.0*b2n1)*cos(b1n1) - 2.0*(gd1n1 - gd2n1)**1.0*sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - (-2.0*ad2n1/tan(a2n1) - 2.0*bd2n1/tan(b2n1))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1))*sin(a1n1)*sin(a2n1) + 2.0*((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))*(ad1n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - ad1n1*sin(a1n1)*cos(a2n1) + ad2n1*(sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - ad2n1*sin(a2n1)*cos(a1n1) + (-bd1n1*sin(b1n1)*cos(b2n1) + bd1n1*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1) + bd2n1*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - bd2n1*sin(b2n1)*cos(b1n1) - (gd1n1 - gd2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n))*sin(a1n1)*sin(a2n1))**1.0*sin(a1n1)*sin(a2n1)*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n)/(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)
    dlamc1term = 0.
    dlamc2term = 0.
    dlamn1term = ((-(sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*sin(b2n1)**(-1.0)*sin(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)**(-1.0)*sin(b2n1)*sin(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(b1n1)*sin(b2n1)*sin(g1n1 - g2n1) - (sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (sin(b1n1)*cos(b2n1)*cos(g1n1 - g2n1) - sin(b2n1)*cos(b1n1))*sin(a1n1)*sin(a2n1)**(-1.0)*sin(b2n1)*cos(b1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + (-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b1n1)*cos(b2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) - (-sin(b1n1)*cos(b2n1) + sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1))*sin(a1n1)**(-1.0)*sin(a2n1)*sin(b2n1)*cos(b1n1)*cos(g1n1 - g2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))*sin(a1n1)*sin(a2n1) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*cos(a2n1) - sin(a2n1)*cos(a1n1))*sin(a2n1)*cos(a1n1)/(m2*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*(-sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) - cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)) + ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a2n1)*cos(a1n1) - sin(a1n1)*cos(a2n1))*sin(a1n1)*cos(a2n1)/(m1*sqrt(1 - ((sin(b1c1)*sin(b2c1)*cos(g1c1 - g2c1) + cos(b1c1)*cos(b2c1))*sin(a1c1)*sin(a2c1) + cos(a1c1)*cos(a2c1))**2.0)))/sqrt(1 - ((sin(b1n1)*sin(b2n1)*cos(g1n1 - g2n1) + cos(b1n1)*cos(b2n1))*sin(a1n1)*sin(a2n1) + cos(a1n1)*cos(a2n1))**2.0)

    derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

    return [mainterm, derivterms]







# rod 2-stage template
# def s2rodtemplate(stepn,stepc1,stepc2,dt,params):
#     # Set to run RadauIIA 2-stage method
#     a11,a12 = [5./12., -1./12.]
#     a21,a22 = [3./4., 1./4.]

#     a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
#     a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
#     a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
#     m1,m2,leq = params

#     mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2)

#     da1c1term  = 0.
#     da1c2term  = 0.
#     db1c1term  = 0.
#     db1c2term  = 0.
#     dg1c1term  = 0.
#     dg1c2term  = 0.
#     da2c1term  = 0.
#     da2c2term  = 0.
#     db2c1term  = 0.
#     db2c2term  = 0.
#     dg2c1term  = 0.
#     dg2c2term  = 0.
#     dad1c1term = 0.
#     dad1c2term = 0.
#     dbd1c1term = 0.
#     dbd1c2term = 0.
#     dgd1c1term = 0.
#     dgd1c2term = 0.
#     dad2c1term = 0.
#     dad2c2term = 0.
#     dbd2c1term = 0.
#     dbd2c2term = 0.
#     dgd2c1term = 0.
#     dgd2c2term = 0.
#     dlamc1term = 0.
#     dlamc2term = 0.

#     derivterms = [da1c1term,da1c2term, db1c1term,db1c2term, dg1c1term,dg1c2term, da2c1term,da2c2term, db2c1term,db2c2term, dg2c1term,dg2c2term, dad1c1term,dad1c2term, dbd1c1term,dbd1c2term, dgd1c1term,dgd1c2term, dad2c1term,dad2c2term, dbd2c1term,dbd2c2term, dgd2c1term,dgd2c2term, dlamc1term,dlamc2term]

#     return [mainterm, derivterms]

# rod 3-stage template
# def s3rodtemplate(stepn,stepc1,stepc2,stepn1,dt,params):
#     root6 = sqrt(6.)
#     # Set to run RadauIIA 3-stage method
#     a11,a12,a13 = [(88.-7.*root6)/360., (296.-169.*root6)/1800., (-2.+3.*root6)/225.]
#     a21,a22,a23 = [(296.+169.*root6)/1800., (88.+7.*root6)/360., (-2.-3.*root6)/225.]
#     a31,a32,a33 = [(16.-root6)/36., (16.+root6)/36., 1./9.]
#     bs1,bs2,bs3 = [(16.-root6)/36., (16.+root6)/36., 1./9.]

#     a1n,b1n,g1n,a2n,b2n,g2n,ad1n,bd1n,gd1n,ad2n,bd2n,gd2n,lamn = stepn
#     a1c1,b1c1,g1c1,a2c1,b2c1,g2c1,ad1c1,bd1c1,gd1c1,ad2c1,bd2c1,gd2c1,lamc1 = stepc1
#     a1c2,b1c2,g1c2,a2c2,b2c2,g2c2,ad1c2,bd1c2,gd1c2,ad2c2,bd2c2,gd2c2,lamc2 = stepc2
#     a1n1,b1n1,g1n1,a2n1,b2n1,g2n1,ad1n1,bd1n1,gd1n1,ad2n1,bd2n1,gd2n1,lamn1 = stepn1
#     m1,m2,leq = params

#     mainterm = a1c1 - a1n - dt*(a11*ad1c1 + a12*ad1c2)

#     da1c1term  = 0.
#     da1c2term  = 0.
#     da1n1term  = 0.
#     db1c1term  = 0.
#     db1c2term  = 0.
#     db1n1term  = 0.
#     dg1c1term  = 0.
#     dg1c2term  = 0.
#     dg1n1term  = 0.
#     da2c1term  = 0.
#     da2c2term  = 0.
#     da2n1term  = 0.
#     db2c1term  = 0.
#     db2c2term  = 0.
#     db2n1term  = 0.
#     dg2c1term  = 0.
#     dg2c2term  = 0.
#     dg2n1term  = 0.
#     dad1c1term = 0.
#     dad1c2term = 0.
#     dad1n1term = 0.
#     dbd1c1term = 0.
#     dbd1c2term = 0.
#     dbd1n1term = 0.
#     dgd1c1term = 0.
#     dgd1c2term = 0.
#     dgd1n1term = 0.
#     dad2c1term = 0.
#     dad2c2term = 0.
#     dad2n1term = 0.
#     dbd2c1term = 0.
#     dbd2c2term = 0.
#     dbd2n1term = 0.
#     dgd2c1term = 0.
#     dgd2c2term = 0.
#     dgd2n1term = 0.
#     dlamc1term = 0.
#     dlamc2term = 0.
#     dlamn1term = 0.

#     derivterms = [da1c1term,da1c2term,da1n1term, db1c1term,db1c2term,db1n1term, dg1c1term,dg1c2term,dg1n1term, da2c1term,da2c2term,da2n1term, db2c1term,db2c2term,db2n1term, dg2c1term,dg2c2term,dg2n1term, dad1c1term,dad1c2term,dad1n1term, dbd1c1term,dbd1c2term,dbd1n1term, dgd1c1term,dgd1c2term,dgd1n1term, dad2c1term,dad2c2term,dad2n1term, dbd2c1term,dbd2c2term,dbd2n1term, dgd2c1term,dgd2c2term,dgd2n1term, dlamc1term,dlamc2term,dlamn1term]

#     return [mainterm, derivterms]

